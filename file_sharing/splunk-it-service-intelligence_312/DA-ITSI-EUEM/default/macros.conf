[is_invalid_ratio(2)]
args = occurrence, total_occurrences
definition = isnull($occurrence$) OR isnull($total_occurrences$)

[is_null_or_empty_string(1)]
args = field
iseval = 0
definition = isnull($field$) OR (trim(tostring($field$)," ")=="")

[normalize_field(1)]
args = field
definition = if(`is_null_or_empty_string($field$)`, "undefined", tostring($field$))

[euem_get-application_key(4)]
args = packageName,platform,appEnvironment,seperator
errormsg = "Argument should not be null"
iseval = 0
validation = isnotnull
definition = tostring($packageName$)."$seperator$".tostring($platform$)."$seperator$".tostring($appEnvironment$)

[euem_get-application_id(3)]
args = packageName,platform,appEnvironment
definition = eval application_id=`euem_get-application_key($packageName$,$platform$,$appEnvironment$,.)`
iseval = 0

[euem_get-application_title(3)]
args = packageName,platform,appEnvironment
definition = eval application_title=`euem_get-application_key($packageName$,$platform$,$appEnvironment$,-)`
iseval = 0

[euem_eventstats-counts(3)]
args = eventstats_ops, condition1, condition2
definition = eventstats $eventstats_ops$($condition1$) as EventCount, $eventstats_ops$($condition2$) as Total

[euem_timechart-counts(3)]
args = timechart_ops, field, entity_field
definition = timechart $timechart_ops$($field$) as Aggregate_count by $entity_field$

[euem_get-counts(3)]
args = eventstats_ops, condition1, condition2
definition = eventstats $eventstats_ops$($condition1$) as EventCount, $eventstats_ops$($condition2$) as Total

[euem_get-counts(2)]
args = condition1, condition2
definition = `euem_get-counts(count,$condition1$,$condition2$)`

[euem_get-rate(2)]
args = occurrence, total_occurrences
definition = eval percentage=if(`is_invalid_ratio($occurrence$, $total_occurrences$)`,0,$occurrence$/$total_occurrences$*100) | eval percentage=round(percentage, 4) | eval percentage=min(percentage, 100)

[evaluate_percentage(3)]
args = fieldname, occurrence, total_occurrences
definition = eval $fieldname$=if($total_occurrences$=0, 0, round($occurrence$/$total_occurrences$*100, 4))

[euem_get_geolocation(1)]
args = ip
definition = iplocation allfields=true $ip$

[euem_get_unique_user_count(2)]
args = entity_field, application_id
definition = tag=euem application_id="$application_id$" | timechart dc(uuid) as "Unique Users" by $entity_field$

[euem_get_unique_sessions_count(2)]
args = entity_field, application_id
definition = tag=euem application_id="$application_id$" | timechart dc(session_id) as "Session Count" by $entity_field$

[euem_get_session_duration(2)]
args = entity_field, application_id
definition = tag=euem application_id="$application_id$" | timechart avg(ses_duration) as "Session Length" by $entity_field$

[euem_get_network_latency(2)]
args = entity_field, application_id
definition = tag=euem tag=performance application_id="$application_id$" | timechart avg(latency) as "Average Network latency" by $entity_field$

[euem_get_pageload_time(2)]
args = entity_field, application_id
definition = tag=euem tag=performance application_id="$application_id$" | timechart avg(dom_processing_time) as "Average Page Load Time" by $entity_field$

[euem_get_crash_rate(2)]
args = entity_field, application_id
definition = tag=euem application_id="$application_id$" | bucket _time span=1h | eventstats count(eval(handled="false")) as CrashCount, dc(session_id) as Total by _time, $entity_field$ | fillnull CrashCount, Total | `evaluate_percentage(CrashRate, CrashCount, Total)` | timechart avg(CrashRate) by $entity_field$ span=1h

[euem_get_http_error_rate(2)]
args = entity_field, application_id
definition = tag=euem tag=performance application_id="$application_id$" | bucket _time span=1h | eventstats count(eval(status_code>299)) as ErrorCount, count(eval(status_code>=0)) as Total by _time, $entity_field$ | fillnull ErrorCount, Total | `evaluate_percentage(HTTPErrorRate, ErrorCount, Total)` | timechart avg(HTTPErrorRate) by $entity_field$ span=1h

[euem_get_network_error_rate(2)]
args = entity_field, application_id
definition = tag=euem tag=performance application_id="$application_id$" | bucket _time span=1h | eventstats count(eval(exception!="NA")) as ErrorCount, count(eval(status_code>=0)) as Total by _time, $entity_field$ | fillnull ErrorCount, Total | `evaluate_percentage(NetworkErrorRate, ErrorCount, Total)` | timechart avg(NetworkErrorRate) by $entity_field$ span=1h
