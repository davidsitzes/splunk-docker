webpackJsonp([18],{0:function(e,t,i){var s,n;i.p=function(){function e(){for(var e,i,s="",n=0,a=arguments.length;n<a;n++)e=arguments[n].toString(),i=e.length,i>1&&"/"==e.charAt(i-1)&&(e=e.substring(0,i-1)),s+="/"!=e.charAt(0)?"/"+e:e;if("/"!=s){var r=s.split("/"),l=r[1];if("static"==l||"modules"==l){var o=s.substring(l.length+2,s.length);s="/"+l,window.$C.BUILD_NUMBER&&(s+="/@"+window.$C.BUILD_NUMBER),window.$C.BUILD_PUSH_NUMBER&&(s+="."+window.$C.BUILD_PUSH_NUMBER),"app"==r[2]&&(s+=":"+t("APP_BUILD",0)),s+="/"+o}}var h=t("MRSPARKLE_ROOT_PATH","/"),d=t("DJANGO_ROOT_PATH",""),c=t("LOCALE","en-US"),u="";return u=d&&s.substring(0,d.length)===d?s.replace(d,d+"/"+c.toLowerCase()):"/"+c+s,""==h||"/"==h?u:h+u}function t(e,t){if(window.$C&&window.$C.hasOwnProperty(e))return window.$C[e];if(void 0!==t)return t;throw new Error("getConfigValue - "+e+" not set, no default provided")}return e("/static/app/itsi/build/pages")+"/"}(),s=[i("require/underscore"),i("shim/jquery"),i("require/backbone"),i("shim/splunk.util"),i(129),i("splunkjs/mvc/sharedmodels"),i("helpers/TourHelper"),i(4),i(231),i(473),i(1685),i(2106)],n=function(e,t,i,s,n,a,r,l,o,h,d,c){var u=l(e("Service Analyzer").t()),p=t("#app-main-layout"),v=function(){var t,i,n=u.defaultTokenModel.get("savedHomeViewId"),l=function(){var e=s.queryStringToProp(window.location.search);if(e.hasOwnProperty("tour")){this.tourName=e.tour;var t=a.get("tours");t&&this.tourName&&this.tourName.length>0&&t.dfd.done(function(){var e=t.getTourModel(this.tourName);e&&r.renderTour(e,a.get("app"),a.get("user"),t)}.bind(this))}},v=new o,g=v.getSpecifiedFields({},"title,enabled,_key,kpis.title,kpis._key,kpis.type,kpis.unit"),f=function(e){l(),g.done(function(t){console.log("serviceCollection partial fetch successful"),i=new c({el:p,pageChrome:u,savedHomeViewSettings:e,serviceObjs:t}),i.render()}).error(function(){console.log("serviceCollection fetch failed")})},m=function(t){var i=new h({errorMessage:e("Could not load settings for the page.").t(),htmlResponse:t});i.show()};if(n){t=new d({_key:n});var S=u.defaultTokenModel.get("owner");S&&t.set("_owner",S),t.fetch({success:function(){t.set("isDefault",!1),f(t)},error:function(e,t){m(t)}})}else n=s.getConfigValue("USERNAME","nobody"),t=new d({_key:n,isDefault:!0}),t.fetch({success:function(){f(t)},error:function(){t.sync("create",t).done(function(){f(t)}.bind(this)).error(function(e){m(e)}.bind(this))}})};n.setupViewFromDefaultTokenModel(u,v,"savedHomeViewId")}.apply(t,s),!(void 0!==n&&(e.exports=n))},2106:function(e,t,i){function s(e){return e&&e.__esModule?e:{default:e}}var n,a,r=i(241),l=s(r),o=i(2107),h=s(o),d=i(1651),c=s(d),u=i(2110),p=s(u),v=i(130),g=s(v);n=[i("require/underscore"),i("shim/jquery"),i("require/backbone"),i("splunkjs/mvc"),i("splunkjs/mvc/utils"),i("shim/splunk.util"),i(458),i(463),i("splunkjs/mvc/searchmanager"),i("splunkjs/mvc/postprocessmanager"),i("splunkjs/mvc/simplexml/urltokenmodel"),i(129),i(473),i(1042),i(231),i(149),i(252),i(1685),i(1248),i(2111),i(2112),i(2119),i(2132),i(2137),i(2142),i(2144),i(2148),i(324),i(1002),i(2182),i(2185),i(2186),i(2187),i(2253),i(2314),i(2317),i(2318),i(2319)],a=function(e,t,i,s,n,a,r,o,d,u,v,f,m,S,_,w,k,M,b,y,T,x,C,I,D,E,V,H,A,O,R,$,P,L,z,F,B){var N=8,K=e("No Results Found").t(),W=e.template('<div class="result-not-found"> <%- message %></div>'),j="kpi-health-data",U="service-health-data",q="health-container",G="service-analyzer-tree-container",Y=e.template(F,null,{variable:"vars"}),J='<div class="homeview-time-range-picker-container"></div><div class="homeview-header-menu"></div>',Q=12e4,X=2e3,Z=' | where alert_level != "-3" ',ee=Z,te=i.View.extend({initialize:function(e){var t=this;e.savedHomeViewSettings instanceof M?(this._originalUserSettingsModel=e.savedHomeViewSettings,this.userSettingsModel=e.savedHomeViewSettings.clone()):(this._originalUserSettingsModel=new M,this.userSettingsModel=this._originalUserSettingsModel.clone()),this.serviceWhitelistIds=[],this.serviceObjs=e.serviceObjs,this.serviceObjs.map(function(e){this.serviceWhitelistIds.push(e._key)}.bind(this)),this.disabledServiceIds=[],this.authorizedServicesIds=this.whitelistToSearchClause(this.serviceWhitelistIds,"serviceid"),this.settingsCollection=new D,this._onBeforeServiceSelect=this.onBeforeServiceSelect.bind(this),this.ftrModalView=null,this.userTzDfd=k.userTimezone.fetchUserAuthTimezone().done(function(e){w.preventInvalidTimezones(e),t.userTimezone=e}),this._firstRender=!0,this.pageChrome=e&&e.pageChrome||{urlTokenModel:new i.Model({view:"standard",viewType:"tile"})};var n=this.pageChrome.urlTokenModel.get("earliest"),a=this.pageChrome.urlTokenModel.get("latest"),r=this.pageChrome.urlTokenModel.get("serviceId"),l=this.pageChrome.urlTokenModel.get("kpiId"),o=this.userSettingsModel.get("selectedServiceId")||"",h=this.userSettingsModel.get("selectedKpiId")||"";this.selectedServiceId="",this.selectedKpiId="";var d=function(e){return e&&t.serviceWhitelistIds.indexOf(e)>-1};d(r)?(this.selectedServiceId=r,this.isServiceKpi(r,l)?this.selectedKpiId=l:this.updateSelectedKpiId("")):d(o)?(this.updateSelectedServiceId(o),this.isServiceKpi(o,h)?this.updateSelectedKpiId(h):this.updateSelectedKpiId("")):(this.updateSelectedServiceId(""),this.updateSelectedKpiId("")),this.selectedServiceId=this.pageChrome.urlTokenModel.get("serviceId"),this.selectedKpiId=this.pageChrome.urlTokenModel.get("kpiId"),n&&a?(this.earliest=n,this.latest=a):(this.earliest=this.userSettingsModel.get("earliest_time")||"-12h",this.latest=this.userSettingsModel.get("latest_time")||"now"),this.serviceWhitelist="",this.kpiWhitelist=[],this.isServiceFilterEnabled=!1,this.isKpiFilterEnabled=!1,this.tokens=s.Components.getInstance("default"),this.tokens.set("disabled_service_blacklist",""),this.tokens.set("disabled_kpi_blacklist",""),this.tokens.set("authorized_service_whitelist",this.authorizedServicesIds),this.tokens.set("service_whitelist",""),this.tokens.set("kpi_whitelist",""),this.tokens.set("service_numTiles","50"),this.tokens.set("kpi_numTiles","50"),this.tokens.set("earliest",this.earliest),this.tokens.set("latest",this.latest),this.tokens.set("service_tree_whitelist","");var c=!1;this.earliest.indexOf("rt")!==-1&&(c=!0),this.tokens.set("indexedRealtime",c),this._updateSearchType(),this._healthSearchDone=!1,this._kpiHealthSearchDone=!1,this._notableEventsSearchDone=!1,this._entitiesSearchDone=!1,this.isAutoRefreshEnabled=!1,this.autoRefreshInterval=Q;var u="auto_refresh",p=B.getServiceAnalyzerConfStanza(u);p.done(function(e){this.isAutoRefreshEnabled=!e.disabled,this.autoRefreshInterval=1e3*e.interval,this.earliest.indexOf("rt")===-1&&this._handleAutoRefresh()}.bind(this))},isServiceKpi:function(e,t){if(t){var i=this.serviceObjs.find(function(t){return e===t._key});if(i.kpis.find(function(e){return t===e._key}))return!0}return!1},_getServiceTopologyTreeStructure:function(i){if(e.isEmpty(this.serviceObjs))return t.Deferred().resolve({});var s=a.make_full_url(["custom","SA-ITOA","itoa_interface","get_service_trees","nobody"].join("/"),i);return t.get(s)},_parseHealthScoreRow:function(e){return{serviceId:e[0],severityName:e[1],severityColor:e[2],healthScore:e[3],serviceTitle:e[5],sparklineData:e[6]}},_populateServicesSettings:function(){this.disabledServiceIds=[];var i=e.where(this.serviceObjs,{enabled:0}),s=this;e.each(i,function(e){s.disabledServiceIds.push(e._key)}),this.disabledKpiIds=[],e.each(i,function(t){e.each(t.kpis,function(e){"ServiceHealthScore"!==e.title&&this.disabledKpiIds.push(e._key)}.bind(this))}.bind(this)),this.assignFilterProperties(),this.serviceObjs.length?this.settingsCollection.fetch().done(function(){if(this.settingsCollection.length){var e=this.settingsCollection.first();a.normalizeBoolean(e.entry.content.get("ftr_override"))&&t(".image-tour").length<1&&(s.ftrModalView=new I({messageId:"no-service",onHiddenRemove:!0,showDismiss:!0,settingsModel:e}),s.ftrModalView.render().show())}}.bind(this)).error(function(){console.log("settingsCollection partial fetch failed")}):t(".image-tour").length<1&&(this.ftrModalView=new I({messageId:"no-service",onHiddenRemove:!0,showDismiss:!1}),this.ftrModalView.render().show())},assignServiceCollectionData:function(){if("undefined"!=typeof this.serviceObjs){for(var e={},t=0;t<this.serviceObjs.length;t++){var i=this.serviceObjs[t],s=i.kpis;if("undefined"!=typeof s&&s.length>0)for(var n=0;n<s.length;n++){var a=s[n],r=a.unit;"undefined"!=typeof r&&null!==r&&""!==r&&(e[a._key]=a.unit)}}this.kpiHealthTilesView.setKpiUnitMap(e)}},assignFilterProperties:function(){var t=this;if("undefined"!=typeof this.userSettingsModel){if(this.userSettingsModel.get("isServiceFilterEnabled")===!0){for(var i=this.userSettingsModel.get("serviceWhitelist").split(","),s=[],n=0;n<i.length;n++){var a=i[n],r=e.findWhere(this.serviceObjs,{_key:a});"undefined"!=typeof r&&null!==r&&s.push(a)}s=s.join(","),this.userSettingsModel.get("serviceWhitelist").length>0&&0===s.length&&this.userSettingsModel.set({isServiceFilterEnabled:!1,kpiWhitelist:[],isKpiFilterEnabled:!1},{silent:!0}),this.userSettingsModel.set({serviceWhitelist:s},{silent:!0})}if(this.userSettingsModel.get("isKpiFilterEnabled")===!0){for(var l=this.userSettingsModel.get("kpiWhitelist"),o=[],h=0;h<l.length;h++){var d=l[h].serviceId,c=l[h].kpiId,u=e.findWhere(this.serviceObjs,{_key:d});if("undefined"!=typeof u&&null!==u){var p=u.kpis,v=e.findWhere(p,{_key:c});"undefined"!=typeof v&&null!==v&&o.push({kpiId:c,serviceId:d})}}this.userSettingsModel.get("kpiWhitelist").length>0&&0===o.length&&this.userSettingsModel.set({isKpiFilterEnabled:!1},{silent:!0}),this.userSettingsModel.set({kpiWhitelist:o},{silent:!0})}if(this.serviceWhitelist=this.userSettingsModel.get("serviceWhitelist"),this.isServiceFilterEnabled=this.userSettingsModel.get("isServiceFilterEnabled"),this.kpiWhitelist=this.userSettingsModel.get("kpiWhitelist"),this.isKpiFilterEnabled=this.userSettingsModel.get("isKpiFilterEnabled"),this.serviceTilesSettingsModel=this.userSettingsModel.get("serviceTilesSettings"),this.kpiTilesSettingsModel=this.userSettingsModel.get("kpiTilesSettings"),this.isServiceFilterEnabled===!0){var g=this.whitelistToSearchClause(this.serviceWhitelist.split(","),"serviceid");this.tokens.set("authorized_service_whitelist",""),this.tokens.set("service_whitelist",g),this.tokens.set("disabled_service_blacklist","")}else this.tokens.set("authorized_service_whitelist",this.authorizedServicesIds),this.tokens.set("service_whitelist",""),this.tokens.set("disabled_service_blacklist",Z);if(this.isKpiFilterEnabled===!0){var f=this.whitelistToSearchClause(this.kpiWhitelist,"kpiid");this.tokens.set("kpi_whitelist",f),this.tokens.set("disabled_service_blacklist","")}else this.tokens.set("kpi_whitelist",""),this.tokens.set("disabled_kpi_blacklist",ee);this.listenTo(this.userSettingsModel,"change",this._enableSave),this.listenTo(this.userSettingsModel,"change:isServiceFilterEnabled change:serviceWhitelist change:showDisabledServices",function(){this.updateWhitelistTokens("service_whitelist")}),this.listenTo(this.userSettingsModel,"change:isKpiFilterEnabled change:kpiWhitelist",function(){this.updateWhitelistTokens("kpi_whitelist")}),this.listenTo(this.serviceTilesSettingsModel,"change:numTiles",function(){this.updateNumTilesTokens("service_numTiles")}),this.listenTo(this.userSettingsModel,"replace",this._replaceUserSettingsModel),this.listenTo(this.kpiTilesSettingsModel,"change:numTiles",function(){this.updateNumTilesTokens("kpi_numTiles")}),this.listenTo(this.userSettingsModel,"change:serviceFilterString",function(){this.isViewTypeTree()&&this.renderServiceAnalyzerTreeView()}),this.updateWhitelistTokens("service_whitelist",!0),this.updateNumTilesTokens("service_numTiles",!0),this.updateNumTilesTokens("kpi_numTiles",!0),this.renderServiceDropdown(),this.renderShowDisabledServicesCheckbox(),this.listenTo(this.userSettingsModel,"change:searchType",function(){t.renderSidePanelView({kpiValueType:t.userSettingsModel.get("searchType")})})}},updateNumTilesTokens:function(e){if("service_numTiles"===e)this.tokens.set(e,this.serviceTilesSettingsModel.get("numTiles"));else{if("kpi_numTiles"!==e)return void console.log("Unrecognized search token: "+e);this.tokens.set(e,this.kpiTilesSettingsModel.get("numTiles"))}},whitelistToSearchClause:function(t,i){var s="",n=this.userSettingsModel.get("showDisabledServices"),a=this,r=t;0===n&&(r=e.filter(r,function(e){return a.disabledServiceIds.indexOf(e)===-1}));for(var l=0;l<r.length;l++){var o=r[l];"kpiid"===i&&(o=o.kpiId),s+=l<r.length-1?" "+i+"="+o+" OR":" "+i+"="+o+" "}return s},updateBlacklistTokens:function(e){1===this.userSettingsModel.get("showDisabledServices")?(this.tokens.set("disabled_service_blacklist",""),this.tokens.set("disabled_kpi_blacklist","")):e?(this.tokens.set("disabled_service_blacklist"," | search serviceid != * "),this.tokens.set("disabled_kpi_blacklist"," | search kpiid != * ")):(this.tokens.set("disabled_service_blacklist",Z),this.tokens.set("disabled_kpi_blacklist",ee))},updateWhitelistTokens:function(e,t){""===this.userSettingsModel.get("serviceWhitelist")?this.userSettingsModel.set({isServiceFilterEnabled:!1},{silent:!0}):this.userSettingsModel.set({isServiceFilterEnabled:!0},{silent:!0});var i;if("service_whitelist"===e){if(this.serviceWhitelist=this.userSettingsModel.get("serviceWhitelist"),this.isServiceFilterEnabled=this.userSettingsModel.get("isServiceFilterEnabled"),"undefined"!=typeof this.serviceTilesSettingsModel&&this.serviceTilesSettingsModel.set("isFilterEnabled",this.isServiceFilterEnabled),this.isServiceFilterEnabled===!0){var s=this.serviceWhitelist.split(",");i=this.whitelistToSearchClause(s,"serviceid"),this.tokens.set("authorized_service_whitelist",""),this.tokens.set(e,i),0===i.length?this.updateBlacklistTokens(!0):this.updateBlacklistTokens(),this.isViewTypeTile()&&this.closeSidePanelIfInvalidSelectedService(s)}else this.tokens.set("authorized_service_whitelist",this.authorizedServicesIds),this.tokens.set(e,""),this.updateBlacklistTokens();"undefined"!=typeof t&&t===!0||this.userSettingsModel.set({isKpiFilterEnabled:!1,kpiWhitelist:[]},{silent:!0}),this.updateWhitelistTokens("kpi_whitelist")}else if("kpi_whitelist"===e){if(this.userSettingsModel.get("isServiceFilterEnabled")===!0){var n=[];this.userSettingsModel.get("kpiWhitelist").forEach(function(e){this.userSettingsModel.get("serviceWhitelist").split(",").indexOf(e.serviceId)>-1&&n.push(e)},this),n.length<1?this.userSettingsModel.set({isKpiFilterEnabled:!1,kpiWhitelist:[]},{silent:!0}):this.userSettingsModel.set({isKpiFilterEnabled:!0,kpiWhitelist:n},{silent:!0})}this.kpiWhitelist=this.userSettingsModel.get("kpiWhitelist"),this.isKpiFilterEnabled=this.userSettingsModel.get("isKpiFilterEnabled"),"undefined"!=typeof this.kpiTilesSettingsModel&&this.kpiTilesSettingsModel.set("isFilterEnabled",this.isKpiFilterEnabled),this.isKpiFilterEnabled===!0?(i=this.whitelistToSearchClause(this.kpiWhitelist,"kpiid"),this.tokens.set(e,i)):(i="",this.userSettingsModel.get("serviceWhitelist").length>0&&(i=this.whitelistToSearchClause(this.serviceWhitelist.split(","),"serviceid")),this.tokens.set(e,i))}else console.log("Unrecognized search token: "+e)},updateSelectedKpiId:function(e){this.selectedKpiId=e,this._updateUrlWithKpiId(),this.userSettingsModel.set("selectedKpiId",e)},updateSelectedServiceId:function(e){this.selectedServiceId=e,this._updateUrlWithServiceId(),this.userSettingsModel.set("selectedServiceId",e)},renderServiceDropdown:function(){this._saDispatcher.trigger("setupServiceDropdown")},renderShowDisabledServicesCheckbox:function(){this._saDispatcher.trigger("setupShowDisabledServicesCheckbox")},_showView:function(){if(this.isViewTypeTree())this.removeTileViews(),this.$("."+q).hide(),this.renderServiceAnalyzerTreeView();else{var e=this.$("."+G);if(e.length>0&&(o.unmountComponentAtNode(e.get(0)),e.remove()),this.$("."+q).show(),this.tokens.set("service_tree_whitelist",""),this.renderHealthScoreTilesView(),this.renderKpiTilesView(),this.isServiceFilterEnabled){var t=this.serviceWhitelist.split(",");this.closeSidePanelIfInvalidSelectedService(t)}}},closeSidePanelIfInvalidSelectedService:function(t){this.sidePanel&&!e.contains(t,this.selectedServiceId)&&this.sidePanel.handleClose()},removeTileViews:function(){this.serviceBarGaugeView&&this.serviceBarGaugeView.remove(),this.kpiBarGaugeView&&this.kpiBarGaugeView.remove(),this.healthScoreTilesView&&this.healthScoreTilesView.remove(),this.kpiHealthTilesView&&this.kpiHealthTilesView.remove()},isViewTypeTile:function(){return"tile"===this.userSettingsModel.get("viewType")},isViewTypeTree:function(){return"service_topology"===this.userSettingsModel.get("viewType")},render:function(){return this.userTzDfd.done(this._internalRender.bind(this)),this},_internalRender:function(){if(this._firstRender){this.$el.html("");var t=this,s=this.pageChrome.urlTokenModel.get("view"),n=this.pageChrome.urlTokenModel.get("viewType"),a='<div class="main-container dashboard-body container-fluid main-section-body"></div>',r=new i.Model({view:s||this.userSettingsModel.get("view"),viewType:n||this.userSettingsModel.get("viewType")});this.$el.append(a),this.listenTo(r,"change:view",function(){t.pageChrome.urlTokenModel.save({view:r.get("view")}),t.userSettingsModel.set("view",r.get("view"))}),this.listenTo(r,"change:viewType",function(){t.pageChrome.urlTokenModel.save({viewType:r.get("viewType")}),t.userSettingsModel.set("viewType",r.get("viewType"))}),this.listenTo(this.userSettingsModel,"change:tileSize",this._updateTileSize),this.listenTo(this.userSettingsModel,"change:searchType",this._updateSearchType),this.$(".view-header-container").append(J),this._appPageHeaderModel=new S({title:this.userSettingsModel.get("title")||e("Service Analyzer").t(),description:this.userSettingsModel.get("description")||"",earliest:this.earliest,latest:this.latest}),this.listenTo(this._appPageHeaderModel,"change:earliest change:latest",this._updateTimeRange),this._saDispatcher=e.extend({},i.Events);var l=new V({saDispatcher:this._saDispatcher,homeViewSettingsModel:this.userSettingsModel,urlTokenModel:t.pageChrome.urlTokenModel});this.$(".main-container").prepend(l.render().el);var o=new E({saDispatcher:this._saDispatcher,appPageHeaderModel:this._appPageHeaderModel,urlTokenModel:t.pageChrome.urlTokenModel,homeViewSettingsModel:this.userSettingsModel});this.$(".main-container").prepend(o.render().el),this.listenTo(this._appPageHeaderModel,"change:viewMode",this._updateUrlWithViewMode),this.listenTo(this.userSettingsModel,"change:viewType",this._updateUrlWithViewType),s?(this._appPageHeaderModel.set({viewMode:s}),this.userSettingsModel.set({view:s})):(this.pageChrome.urlTokenModel.save({view:this.userSettingsModel.get("view")}),this._appPageHeaderModel.set({viewMode:this.userSettingsModel.get("view")})),n?this.userSettingsModel.set({viewType:n}):this.pageChrome.urlTokenModel.save({viewType:this.userSettingsModel.get("viewType")}),this.listenTo(this.userSettingsModel,"change:viewType",this._showView),this._updateURL(),this.healthScoreSearchManagerBase=new d({search:'`service_health_data` serviceid $service_whitelist$ $service_tree_whitelist$ $authorized_service_whitelist$ `service_level_kpi_only` | stats latest(severity_label) AS severity_label latest(color) AS color latest(health_score) AS severity_value latest(alert_level) as alert_level latest(service) AS service sparkline(avg(health_score)) AS spark by serviceid | lookup service_kpi_lookup _key AS serviceid OUTPUT title AS service | search service=* | sort 0 severity_value | eval severity_level=100-severity_value | eval empty=""',earliest_time:"$earliest$",latest_time:"$latest$",indexedRealtime:"$indexedRealtime$",indexedRealtimeOffset:60,id:"health-score-tile-manager-base",auto_cancel:65},{tokens:!0}),this.healthScoreManager=new u({search:"| head $service_numTiles$ $disabled_service_blacklist$",managerid:this.healthScoreSearchManagerBase.id,id:"health-score-tile-manager"},{tokens:!0}),this.sidePanelHealthScoreManager=new u({search:"| search serviceid=$selectedServiceId$",managerid:this.healthScoreSearchManagerBase.id,id:"sidebar-manager"},{tokens:!0}),this.kpiHealthManagerBase=new d({search:'`get_itsi_summary_index` source!=service_health_monitor serviceid $authorized_service_whitelist$ kpiid $maxSeverityMacroString$ | eval alert_value=coalesce(alert_value,"N/A") | stats latest(alert_value) AS alert_value latest(alert_severity) AS severity_label latest(alert_color) AS color latest(alert_level) AS alert_level latest(service) AS service sparkline(avg(alert_value)) AS spark latest(kpi) AS kpi latest(serviceid) AS serviceid by kpiid $disabled_kpi_blacklist$ | join kpiid [| inputlookup service_kpi_lookup | rename kpis._key AS kpiid, title as service | fields kpiid, service | mvexpand kpiid] | sort 0 -alert_level | makemv delim=" " alert_value | eval alert_value=max(alert_value)',earliest_time:"$earliest$",latest_time:"$latest$",indexedRealtime:"$indexedRealtime$",indexedRealtimeOffset:60,id:"kpi-health-manager-base",auto_cancel:65},{tokens:!0}),this.kpiHealthManager=new u({search:"| search $kpi_whitelist$ | head $kpi_numTiles$",managerid:this.kpiHealthManagerBase.id,id:"kpi-health-tile-manager"},{tokens:!0}),this.sidePanelKpiHealthManager=new u({search:"| search kpiid=$selectedKpiId$",managerid:this.kpiHealthManagerBase.id,id:"kpi-sidebar-manager"},{tokens:!0}),this.highAndCriticalNotableEventsManager=new d({search:'(`itsi_event_management_group_index`) itsi_service_ids!=null | stats latest(itsi_group_severity) as severity latest(itsi_group_status) as status values(itsi_service_ids) as itsi_service_ids by itsi_group_id  | lookup itsi_notable_event_group_lookup _key AS itsi_group_id OUTPUT severity AS lookup_severity, status AS lookup_status, owner AS lookup_owner | eval severity=if(isnull(lookup_severity), severity, lookup_severity), status=if(isnull(lookup_status), status, lookup_status) | fields - lookup_* | search severity>4 status!=5 | eval itsi_service_ids=mvjoin(itsi_service_ids, ",")| makemv delim="," itsi_service_ids | mvexpand itsi_service_ids | rename itsi_service_ids as services | table services | dedup services',earliest_time:"$earliest$",latest_time:"$latest$",indexedRealtime:"$indexedRealtime$",indexedRealtimeOffset:60,id:"notable-events-search-manager",auto_cancel:65},{tokens:!0}),this.entityHealthManagerBase=new d({search:"`get_itsi_summary_index` `entity_level_kpi_only` indexed_is_service_aggregate::0 | stats sparkline(avg(alert_value)) AS sparkline latest(alert_level) AS alert_level latest(alert_value) AS alert_value latest(alert_severity) AS alert_severity latest(alert_color) AS alert_color by entity_title, entity_key, itsi_service_id, itsi_kpi_id | table alert_level, alert_value, alert_severity, alert_color, entity_title, entity_key, itsi_service_id, itsi_kpi_id, sparkline",earliest_time:"$earliest$",latest_time:"$latest$",indexedRealtime:"$indexedRealtime$",indexedRealtimeOffset:60,cache:!1,id:"entity-health-search-manager-base",auto_cancel:300},{tokens:!0}),this.highAndCriticalEntitiesSearchManager=new u({search:"| where alert_level>4 | table itsi_service_id, itsi_kpi_id | dedup itsi_kpi_id | stats list(itsi_kpi_id) as itsi_kpi_ids by itsi_service_id | table itsi_service_id, itsi_kpi_ids",managerid:this.entityHealthManagerBase.id,id:"degraded-entities-search-manager"},{tokens:!0}),this.$(".main-container").append(Y({_:e},{variable:"vars"})),this.renderSidePanelView(),this._firstRender=!1,this._populateServicesSettings()}return this._showView(),this.selectedServiceId&&this.renderSidePanelView({serviceId:this.selectedServiceId,selectedKpiId:this.selectedKpiId}),this},renderHealthScoreTilesView:function(){var i=t("<div/>").addClass("service-health-tiles");this.healthScoreTilesView&&this.healthScoreTilesView.remove(),this.healthScoreTilesView=new y({saDispatcher:this._saDispatcher,el:i,tileView:"home_view",tileSize:this.userSettingsModel.get("tileSize"),serviceWhitelistIds:this.serviceWhitelistIds,earliest:this.earliest,latest:this.latest,severityTilesConfig:{idField:"serviceid",severityLabelField:"severity_label",severityLevelField:"severity_level",severityColorField:"color",valueField:"severity_value",sparklineField:"spark",labelField:"service",subLabelField:"empty",searchManager:this.healthScoreManager,dataFields:["serviceid"]},highAndCriticalNotableEventsManager:this.highAndCriticalNotableEventsManager,highAndCriticalEntitiesSearchManager:this.highAndCriticalEntitiesSearchManager,severityTilesTitle:e("Services").t(),drilldownFunction:function(t,i){var s=this,n=this.earliest;if(n.indexOf("rt")!==-1&&(n="-"+this.earliest.split("-")[1]),i)if(1===t.length){var a={context_id:t[0].model.get("dataFields").serviceid,include_all_kpi:!0,earliest:n,latest:"now",owner:"nobody"};H.requestToServer("POST","/custom/SA-ITOA/deep_dive_services/redirect/nobody",!1,!0,a)}else{var r=e.map(t,function(t){var i=t.model;return{search:"`service_health_score_time_series("+i.get("dataFields").serviceid+")`",title:i.get("label"),subtitle:e("Health Score").t(),searchSource:"kpi",laneType:"kpi",kpiServiceId:i.get("dataFields").serviceid,kpiId:"SHKPI-"+i.get("dataFields").serviceid,thresholdIndicationEnabled:"enabled",thresholdIndicationType:"stateIndication"}});H.requestToServer("POST","/custom/SA-ITOA/deep_dive_services/redirect/nobody",!1,!1,{lane_settings_collection:(0,g.default)(r),earliest:n,latest:"now"})}else{var l=t[0],o=l.model.get("id");this.updateSelectedKpiId(""),this.updateSelectedServiceId(o),l.$el.addClass("severity-tile-clicked"),this.renderSidePanelView({serviceId:o}).done(function(){s.scrollTileIntoView(l.el)})}}.bind(this),tilesSettingsModel:this.serviceTilesSettingsModel,renderModalFunction:function(){var e=new x({settingsModel:this.serviceTilesSettingsModel,onHiddenRemove:!0});t("body").append(e.render().el),e.show()}.bind(this),summaryContainerClass:U,hasSublabel:!1}),this.healthScoreTilesView.setSettingsModel(this.serviceTilesSettingsModel),this.healthScoreTilesView.render(),this.getServiceHealthSummary(),this.healthScoreTilesView.$(".severity-tiles-config").show(),this.$(".service-health-container").append(i)},renderKpiTilesView:function(){var i=t("<div/>").addClass("kpi-health-tiles");this.kpiHealthTilesView&&this.kpiHealthTilesView.remove(),this.kpiHealthTilesView=new b({saDispatcher:this._saDispatcher,el:i,tileView:"home_view",tileSize:this.userSettingsModel.get("tileSize"),serviceWhitelistIds:this.serviceWhitelistIds,earliest:this.earliest,latest:this.latest,severityTilesConfig:{idField:"kpiid",severityLabelField:"severity_label",severityLevelField:"alert_level",severityColorField:"color",valueField:"alert_value",sparklineField:"spark",labelField:"kpi",subLabelField:"service",searchManager:this.kpiHealthManager,dataFields:["kpiid","serviceid"]},highAndCriticalNotableEventsManager:this.highAndCriticalNotableEventsManager,highAndCriticalEntitiesSearchManager:this.highAndCriticalEntitiesSearchManager,severityTilesTitle:e("KPIs").t(),drilldownFunction:function(t,i){var s=this,n=this.earliest;if(n.indexOf("rt")!==-1&&(n="-"+this.earliest.split("-")[1]),i)if(1===t.length){var a={context_id:t[0].model.get("dataFields").serviceid,include_all_kpi:!0,earliest:n,latest:"now",owner:"nobody"};H.requestToServer("POST","/custom/SA-ITOA/deep_dive_services/redirect/nobody",!1,!0,a)}else H.openInDeepDive(!1,e.map(t,function(e){var t=e.model;return{kpiId:t.get("dataFields").kpiid,serviceId:t.get("dataFields").serviceid,kpiName:t.get("label"),serviceName:t.get("sublabel")}}),n,"now");else{var r=t[0],l=r.model.get("dataFields").serviceid,o=r.model.get("id");this.updateSelectedServiceId(l),this.updateSelectedKpiId(o),r.$el.addClass("severity-tile-clicked"),this.renderSidePanelView({serviceId:l,selectedKpiId:o}).done(function(){s.scrollTileIntoView(r.el)})}}.bind(this),tilesSettingsModel:this.kpiTilesSettingsModel,renderModalFunction:function(){var e=new C({userSettingsModel:this.userSettingsModel,onHiddenRemove:!0,optionalSettingsModel:this.kpiTilesSettingsModel});t("body").append(e.render().el),e.show()}.bind(this),summaryContainerClass:j}),this.kpiHealthTilesView.setSettingsModel(this.kpiTilesSettingsModel),this.assignServiceCollectionData(),this.kpiHealthTilesView.render(),this.getKpiSummary(),this.kpiHealthTilesView.$(".severity-tiles-config").show(),this.$(".kpi-health-container").append(i)},renderSidePanelView:function(i){var s=this,n=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];i=i||{};var a=i.kpiValueType?i.kpiValueType:this.userSettingsModel.get("searchType"),l=t.Deferred(),h=function(){s.isViewTypeTree()?s.serviceAnalyzerTreeView&&s.serviceAnalyzerTreeView.selectService():s.healthScoreTilesView&&s.healthScoreTilesView.clearClickedTile(),s.updateSelectedKpiId(s.selectedKpiId)},d=function(){s.isViewTypeTree()?s.serviceAnalyzerTreeView&&s.serviceAnalyzerTreeView.clearSelectedService():s.healthScoreTilesView&&s.healthScoreTilesView.clearClickedTile(),s.updateSelectedServiceId(""),s.updateSelectedKpiId("")},c=e.extend({servicesList:this.serviceObjs,healthScoreSearchManager:this.sidePanelHealthScoreManager,kpiHealthSearchManager:this.sidePanelKpiHealthManager,kpiBaseSearchId:this.kpiHealthManagerBase.id,entityBaseSearchId:this.entityHealthManagerBase.id,highAndCriticalEntitiesSearchManager:this.highAndCriticalEntitiesSearchManager,parseHealthScoreRow:this._parseHealthScoreRow,updateSelectedKpiId:this.updateSelectedKpiId.bind(this),selectedKpiId:this.selectedKpiId,timezoneId:this.userTimezone.get("id"),kpiValueType:a,onKpiOpen:h,onKpiClose:h,onSlideEnd:function(){n&&l.resolve()},onClose:d},i);return this.sidePanel=o.render(r.createElement(L,c),this.$(".side-panel").get(0),function(){n||l.resolve()}),l},scrollTileIntoView:function(e){if(e)try{e.scrollIntoView({block:"center",inline:"nearest",behavior:"smooth"})}catch(t){e.scrollIntoView({behavior:"smooth"})}},renderServiceAnalyzerTreeView:function(){var i=this.$("."+G);0===i.length&&(i=t("<div />").addClass(G),this.$(".dynamic-container").prepend(i));var s=this.$(".service-analyzer-tree-loading",i);0===s.length&&(s=t("<div />").addClass("service-analyzer-tree-loading"),i.append(s));var n=s.get(0);o.unmountComponentAtNode(n),o.render(r.createElement(z,null),n);var a=this.getFilteredServiceIds();return this._getServiceTopologyTreeStructure({filter:(0,g.default)(a)}).done(function(t){t=e.extend({graphs:[]},t);var s=i.get(0);o.unmountComponentAtNode(s);var l=t.graphs,h=this.userSettingsModel.get("isServiceFilterEnabled")===!0;if(h===!1&&e.isEmpty(this.serviceObjs)&&e.isEmpty(l))return this.serviceAnalyzerTreeView=null,void o.render(r.createElement(O,null),s,function(){o.unmountComponentAtNode(n)});if(t.totalCount>X)return this.serviceAnalyzerTreeView=null,void o.render(r.createElement(R,null),s,function(){o.unmountComponentAtNode(n)});var d=new $(l),c=h?this.makeServiceTreeWhitelistClause(d):"";this.tokens.set("service_tree_whitelist",c);var u=this.sidePanel&&this.sidePanel.getServiceId()||null,p=d.getVertexById(u)?u:e.first(a);this.serviceAnalyzerTreeView=o.render(r.createElement(P,{graphsStore:d,healthScoresSearchManager:this.healthScoreSearchManagerBase,notableEventsSearchManager:this.highAndCriticalNotableEventsManager,degradedEntitiesSearchManager:this.highAndCriticalEntitiesSearchManager,onBeforeServiceSelect:this._onBeforeServiceSelect,parseHealthScoreRow:this._parseHealthScoreRow,initialSelectedServiceId:p}),s,function(){o.unmountComponentAtNode(n),this.closeSidePanelIfInvalidSelectedService(d.getVertexIds())}.bind(this))}.bind(this)).fail(function(t){var i=new m({errorMessage:e("Could not retrieve the Service Tree structure.").t(),htmlResponse:t});i.show(),o.unmountComponentAtNode(n)}),i},onBeforeServiceSelect:function(){function e(e){return t.apply(this,arguments)}var t=(0,p.default)(h.default.mark(function e(t){var i=this;return h.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new c.default(function(e){var s=t.id;i.updateSelectedServiceId(s);var n=i.isServiceKpi(s,i.selectedKpiId)?i.selectedKpiId:"";i.updateSelectedKpiId(n),
i.renderSidePanelView({serviceId:s,selectedKpiId:n},!1).done(function(){var t=o.findDOMNode(i.sidePanel),s=t.getBoundingClientRect(),n=i.sidePanel.getWidth(),a=-(n-s.width);e({widthOffsetX:a})})}));case 1:case"end":return e.stop()}},e,this)}));return e}(),makeServiceTreeWhitelistClause:function(t){var i={},s=this.tokens.get("service_whitelist")||"";e.each(s.split("OR"),function(e){var t=e.split("="),s=t.length>1?t[1].trim():null;s&&(i[s]=!0)});var n=e.filter(t.getVertexIds(),function(e){return i[e]!==!0}),a=this.whitelistToSearchClause(n,"serviceid"),r=e.isEmpty(s)?a:" OR "+a;return r},getFilteredServiceIds:function(){var t=this.userSettingsModel.get("serviceFilterString"),i=a.stringToFieldList(t),s=e.map(i,function(e){var t=e.indexOf("*")<0?e:f.escapeAllRegexCharsButStar(e),i=new RegExp("^"+t.replace(/\*/g,".*")+"$","i");return i}),n={};this.serviceObjs.forEach(function(e){s.forEach(function(t){t.test(e.title)&&(n[e._key]=!0)})});var r=(0,l.default)(n);return 0===r.length&&i.length>0?["NotFound"]:r},showMessage:function(e,t){var i=this.$("."+e);i&&(i.empty(),i.html(W({message:t})))},getKpiSummary:function(){this.kpiSummaryCollection=new i.Collection,this.kpiSummaryData&&this.stopListening(this.kpiSummaryData),this.kpiSummaryData=this.kpiHealthTilesView._severityTilesDataAdapters[0].model.get("searchManager").data("preview",{count:0,output_mode:"json"}),this.listenTo(this.kpiSummaryData,"data",this.getKpiSummaryData)},getKpiSummaryData:function(){if(this.kpiSummaryData.hasData()){var t=this.kpiSummaryData.data().results,s={},n=t.filter(function(e){return this.serviceWhitelistIds.indexOf(e.serviceid)!==-1}.bind(this));n.forEach(function(e){"undefined"==typeof s[e.severity_label]?s[e.severity_label]={name:e.severity_label,value:1,color:e.color}:s[e.severity_label].value+=1});var a=[];e.each(s,function(e){a.push({name:e.name,value:e.value,color:e.color})});var r=new i.Collection(a);this.showKpiSummaryData(r)}else this.showMessage(j,K)},showKpiSummaryData:function(e){this.kpiSummaryCollection.reset(e.toJSON()),this.kpiBarGaugeView=new T({collection:this.kpiSummaryCollection,barGaugeHeight:N,isShowBarGauge:!0,el:this.$("."+j)}),this.kpiBarGaugeView.render()},getServiceHealthSummary:function(){this.serviceHealthSummaryCollection=new i.Collection,this.serviceHealthData&&this.stopListening(this.serviceHealthData),this.serviceHealthData=this.healthScoreTilesView._severityTilesDataAdapters[0].model.get("searchManager").data("preview",{count:0,output_mode:"json"}),this.listenTo(this.serviceHealthData,"data",this.getServiceHealthData)},getServiceHealthData:function(){if(this.serviceHealthData.hasData()){var t=this.serviceHealthData.data().results,s={},n=t.filter(function(e){return this.serviceWhitelistIds.indexOf(e.serviceid)!==-1}.bind(this));n.forEach(function(e){"undefined"==typeof s[e.severity_label]?s[e.severity_label]={name:e.severity_label,value:1,color:e.color}:s[e.severity_label].value+=1});var a=[];e.each(s,function(e){a.push({name:e.name,value:e.value,color:e.color})});var r=new i.Collection(a);this.showServiceHealthSummaryData(r)}else this.showMessage(U,K)},showServiceHealthSummaryData:function(e){this.serviceHealthSummaryCollection.reset(e.toJSON()),this.serviceBarGaugeView=new T({collection:this.serviceHealthSummaryCollection,barGaugeHeight:N,isShowBarGauge:!0,el:this.$("."+U)}),this.serviceBarGaugeView.render()},_validateTime:function(){this.earliest=this._appPageHeaderModel.get("earliest");var e="-45m",t=this.earliest,i=!1;t.indexOf("rt")!==-1&&(i=!0,t=this.earliest.split("-")[1]);var s=!1;t?t.indexOf("m")>0&&t.indexOf("h")<0&&t.indexOf("mon")<0?(t.indexOf("@")>0&&(t=t.split("@")[0]),Math.abs(parseInt(t))<45&&(s=!0,i?this.earliest="rt"+e:this.earliest=e)):t.indexOf("s")>0&&t.indexOf("m")<0&&(t.indexOf("@")>0&&(t=t.split("@")[0]),Math.abs(parseInt(t))<2700&&(s=!0,i?this.earliest="rt"+e:this.earliest=e)):(s=!0,this.earliest=e),this.latest=this._appPageHeaderModel.get("latest"),i&&"rtnow"!==this.latest&&(s=!0,this.latest="rtnow"),i?this.tokens.set("indexedRealtime",!0):this.tokens.set("indexedRealtime",!1),s&&this._appPageHeaderModel.set({earliest:this.earliest,latest:this.latest})},_updateUrlWithViewMode:function(){this._firstRender?this.pageChrome.urlTokenModel.get("view")&&this._saDispatcher.trigger("changeViewMode"):this.pageChrome.urlTokenModel.save({view:this._appPageHeaderModel.get("viewMode")})},_updateUrlWithViewType:function(){this._firstRender||this.pageChrome.urlTokenModel.save({viewType:this.userSettingsModel.get("viewType")})},_updateUrlWithServiceId:function(){""===this.selectedServiceId?this._removeQueryParam("serviceId"):this.pageChrome.urlTokenModel.save({serviceId:this.selectedServiceId},{replaceState:!0})},_updateUrlWithKpiId:function(){""===this.selectedKpiId?this._removeQueryParam("kpiId"):this.pageChrome.urlTokenModel.save({kpiId:this.selectedKpiId},{replaceState:!0})},_removeQueryParam:function(e){"undefined"!=typeof this.pageChrome.urlTokenModel.saveClassicUrl&&(this.pageChrome.urlTokenModel.saveClassicUrl({replaceState:!0,unset:!0}),this.pageChrome.urlTokenModel.unset(e),this.pageChrome.urlTokenModel.save(this.pageChrome.urlTokenModel.attributes,{replaceState:!0}))},_updateTimeRange:function(){this._updateURL(),this.tokens.set("earliest",this.earliest),this.tokens.set("latest",this.latest),this.healthScoreTilesView&&this.kpiHealthTilesView&&(this.healthScoreTilesView.earliest=this.earliest,this.kpiHealthTilesView.earliest=this.earliest);var e=this.userSettingsModel.get("earliest_time");this.userSettingsModel.set({earliest_time:this.earliest,latest_time:this.latest}),this.renderSidePanelView({earliest:this.earliest,latest:this.latest}),e.indexOf("rt")!==-1&&this.userSettingsModel.get("earliest_time").indexOf("rt")===-1?this._handleAutoRefresh():e.indexOf("rt")===-1&&this.userSettingsModel.get("earliest_time").indexOf("rt")!==-1&&(clearInterval(this.autoRefreshObject),this.stopListening(this.healthScoreSearchManagerBase,"search:done",this._healthSearchManagerDoneListener),this.stopListening(this.kpiHealthManagerBase,"search:done",this._kpiHealthSearchManagerDoneListener),this.stopListening(this.highAndCriticalNotableEventsManager,"search:done",this._notableEventsManagerDoneListener),this.stopListening(this.entityHealthManagerBase,"search:done",this._entitiesManagerDoneListener))},_updateURL:function(){this._validateTime(),this.pageChrome.urlTokenModel.save({earliest:this.earliest,latest:this.latest})},_enableSave:function(){this._saDispatcher.trigger("enableSave")},_updateTileSize:function(){this.healthScoreTilesView.prevTileSize=this.healthScoreTilesView.tileSize,this.healthScoreTilesView.tileSize=this.userSettingsModel.get("tileSize"),this.healthScoreTilesView.render(),this.kpiHealthTilesView.prevTileSize=this.kpiHealthTilesView.tileSize,this.kpiHealthTilesView.tileSize=this.userSettingsModel.get("tileSize"),this.kpiHealthTilesView.render()},_updateSearchType:function(){var e="`service_level_kpi_only`";this.userSettingsModel&&"maxseverity"===this.userSettingsModel.get("searchType")&&(e="`service_level_max_severity_and_service_health_score`"),this.tokens.set("maxSeverityMacroString",e)},_replaceUserSettingsModel:function(e){this.setUserSettingsModel(e),this._saDispatcher.trigger("updateUserSettingsModel",this.userSettingsModel),this.listenTo(this.userSettingsModel,"change:tileSize",this._updateTileSize),this.listenTo(this.userSettingsModel,"change:searchType",this._updateSearchType)},_updateAppPageHeaderModel:function(){this._appPageHeaderModel.set({title:this.userSettingsModel.get("title"),description:this.userSettingsModel.get("description"),earliest:this.earliest,latest:this.latest})},setUserSettingsModel:function(e){e instanceof i.Model&&(this.userSettingsModel instanceof i.Model&&this.stopListening(this.userSettingsModel),this.userSettingsModel=e,this._populateServicesSettings())},_handleAutoRefresh:function(){this.earliest.indexOf("rt")===-1&&this.isAutoRefreshEnabled&&(clearInterval(this.autoRefreshObject),this.autoRefreshObject=setInterval(function(){"undefined"!=typeof this.healthScoreSearchManagerBase&&"undefined"!=typeof this.kpiHealthManagerBase&&"undefined"!=typeof this.highAndCriticalNotableEventsManager&&"undefined"!=typeof this.entityHealthManagerBase&&(this.stopListening(this.healthScoreSearchManagerBase,"search:done",this._healthSearchManagerDoneListener),this.stopListening(this.kpiHealthManagerBase,"search:done",this._kpiHealthSearchManagerDoneListener),this.stopListening(this.highAndCriticalNotableEventsManager,"search:done",this._notableEventsManagerDoneListener),this.stopListening(this.entityHealthManagerBase,"search:done",this._entitiesManagerDoneListener),this._healthSearchDone=!1,this._kpiHealthSearchDone=!1,this._notableEventsSearchDone=!1,this._entitiesSearchDone=!1,this.healthScoreSearchManagerBase.get("data").isDone&&this.kpiHealthManager.get("data").isDone&&this.highAndCriticalNotableEventsManager.get("data").isDone&&this.entityHealthManagerBase.get("data").isDone?(this.healthScoreSearchManagerBase.cancel(),this.healthScoreSearchManagerBase.createSearch(),this.kpiHealthManagerBase.cancel(),this.kpiHealthManagerBase.createSearch(),this.highAndCriticalNotableEventsManager.cancel(),this.highAndCriticalNotableEventsManager.createSearch(),this.entityHealthManagerBase.cancel(),this.entityHealthManagerBase.createSearch()):(this.listenTo(this.healthScoreSearchManagerBase,"search:done",this._healthSearchManagerDoneListener),this.listenTo(this.kpiHealthManagerBase,"search:done",this._kpiHealthSearchManagerDoneListener),this.listenTo(this.highAndCriticalNotableEventsManager,"search:done",this._notableEventsManagerDoneListener),this.listenTo(this.entityHealthManagerBase,"search:done",this._entitiesManagerDoneListener),clearInterval(this.autoRefreshObject)))}.bind(this),this.autoRefreshInterval))},_healthSearchManagerDoneListener:function(){this.stopListening(this.healthScoreSearchManagerBase,"search:done",this._healthSearchManagerDoneListener),this._healthSearchDone=!0,this._healthSearchDone&&this._kpiHealthSearchDone&&this._notableEventsSearchDone&&this._entitiesSearchDone&&this._handleAutoRefresh()},_kpiHealthSearchManagerDoneListener:function(){this.stopListening(this.kpiHealthManagerBase,"search:done",this._kpiHealthSearchManagerDoneListener),this._kpiHealthSearchDone=!0,this._kpiHealthSearchDone&&this._notableEventsSearchDone&&this._healthSearchDone&&this._entitiesSearchDone&&this._handleAutoRefresh()},_notableEventsManagerDoneListener:function(){this.stopListening(this.highAndCriticalNotableEventsManager,"search:done",this._notableEventsManagerDoneListener),this._notableEventsSearchDone=!0,this._notableEventsSearchDone&&this._healthSearchDone&&this._kpiHealthSearchDone&&this._entitiesSearchDone&&this._handleAutoRefresh()},_entitiesManagerDoneListener:function(){this.stopListening(this.entityHealthManagerBase,"search:done",this._entitiesManagerDoneListener),this._entitiesSearchDone=!0,this._notableEventsSearchDone&&this._healthSearchDone&&this._kpiHealthSearchDone&&this._entitiesSearchDone&&this._handleAutoRefresh()}});return te}.apply(t,n),!(void 0!==a&&(e.exports=a))},2111:function(e,t,i){"use strict";function s(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var n=i(479),a=s(n),r=i(482),l=s(r),o=i(483),h=s(o),d=i(484),c=s(d),u=i(485),p=s(u),v=i(1248),g=s(v),f=i(1252),m=s(f),S=function(e){function t(){return(0,l.default)(this,t),(0,c.default)(this,(t.__proto__||(0,a.default)(t)).apply(this,arguments))}return(0,p.default)(t,e),(0,h.default)(t,[{key:"createSeverityTileView",value:function(e){return new m.default({model:e,tileSize:this.tileSize,yMin:0,yMax:100})}}]),t}(g.default);t.default=S,e.exports=t.default},2112:function(e,t,i){var s,n;s=[i("require/underscore"),i("shim/jquery"),i("require/backbone"),i("shim/splunk.util"),i(2113),i(2116),i(2117)],n=function(e,t,i,s,n,a){var r=i.View.extend({initialize:function(e){this.collection=e&&e.collection,this.barGaugeHeight=e&&e.barGaugeHeight,this.isShowBarGauge=e&&e.isShowBarGauge,this.listenTo(this.collection,"change add remove reset destory",this.render)},renderSummaryView:function(t){var i=0;if(e.each(t,function(e){i=parseInt(i,10)+parseInt(e.value,10)}),null===i||0===i)this.$el.append('<div class="result-not-found">'+e("No result found").t()+"</div>");else{e.each(t,function(e){this.$(".summary-container").append('<div class="circle-icon"><span class="icon-circle-filled" style="color:'+e.color+';"> </span><span class="value-container">'+e.value+"</span></div>")}.bind(this));var n=s.sprintf(e("%s Total").t(),i);this.$(".summary-container").append('<div class="total-btn"><span>'+n+"</span></div>")}},render:function(){this.$el.html(a),this.isShowBarGauge&&(this.gaugeView&&this.gaugeView.remove(),this.gaugeView=new n({collection:this.collection,height:this.barGaugeHeight}),this.$(".gauge-view-container").append(this.gaugeView.render().el));var e=this.collection.map(function(e){return{value:e.get("value")||null,color:e.get("color")||""}}.bind(this));return this.renderSummaryView(e),this}});return r}.apply(t,s),!(void 0!==n&&(e.exports=n))},2113:function(e,t,i){var s,n;s=[i("require/underscore"),i("shim/jquery"),i("require/backbone"),i(2114)],n=function(e,t,i){var s=i.View.extend({initialize:function(e){this.collection=e&&e.collection,this.height=e&&e.height||20,this.listenTo(this.collection,"change add remove reset destroy",this.render)},renderBarGauge:function(t,i){var s=0;e.each(i,function(e){s=parseInt(s,10)+parseInt(e.value,10)}),null===s||0===s?this.$el.append('<div class="result-not-found">'+e("No result found").t()+"</div>"):(e.each(i,function(e){e.widthPercentage=Math.floor(e.value/s*100*1e3)/1e3}),e.each(i,function(e,s){var n=null;0===s&&(n="left-round-corner"),s===i.length-1&&(n+=" right-round-corner");var a;a=n?'<div class="'+n+'" style="width:'+e.widthPercentage+"%;background:"+e.color+";float:left;height:"+t+'px"></div>':'<div style="width:'+e.widthPercentage+"%;background:"+e.color+";float:left;height:"+t+'px"></div>',this.$el.append(a)}.bind(this)))},render:function(){var e=this.collection.map(function(e){return{value:e.get("value")||null,color:e.get("color")||""}}.bind(this));return this.renderBarGauge(this.height,e),this}});return s}.apply(t,s),!(void 0!==n&&(e.exports=n))},2114:function(e,t,i){var s=i(2115);"string"==typeof s&&(s=[[e.id,s,""]]);i(15)(s,{});s.locals&&(e.exports=s.locals)},2115:function(e,t,i){t=e.exports=i(14)(),t.push([e.id,".result-not-found{color:#999;text-align:center}.left-round-corner{border-top-left-radius:5px;border-bottom-left-radius:5px}.right-round-corner{border-top-right-radius:5px 5px;border-bottom-right-radius:5px 5px}",""])},2116:function(e,t){e.exports='<div class="summary-container">\n\t\n</div>\n<div class="gauge-view-container">\n\t\n</div>\n'},2117:function(e,t,i){var s=i(2118);"string"==typeof s&&(s=[[e.id,s,""]]);i(15)(s,{});s.locals&&(e.exports=s.locals)},2118:function(e,t,i){t=e.exports=i(14)(),t.push([e.id,".circle-icon{float:left;padding-right:10px;padding-top:5px}.total-btn{float:right;padding-left:15px;padding-right:5px;padding-top:5px}.result-not-found{color:#999;text-align:center}.gauge-view-container,.summary-container{padding:10px 10px 10px 20px;clear:both}.value-container{padding:5px}",""])},2119:function(e,t,i){var s,n;s=[i("shim/jquery"),i("require/underscore"),i("require/backbone"),e,i("views/shared/Modal"),i("views/shared/controls/ControlGroup"),i("views/shared/controls/SyntheticRadioControl"),i("views/shared/FlashMessagesLegacy"),i("collections/shared/FlashMessages"),i(929),i(231),i(1685),i(2120),i(2122),i(2121),i(1686),i(2130)],n=function(e,t,i,s,n,a,r,l,o,h,d,c,u,p,v,g,f){return n.extend({moduleId:String(s.id),initialize:function(e){n.prototype.initialize.apply(this,arguments),this._title=t("Filter Service Tiles").t(),this._primaryButtonText=t("Save").t(),this._maxNumTiles=500,this._inputSettingsModel=e.settingsModel||new g,this._settingsModel=new g(this._inputSettingsModel.attributes),this._settingsModel.set("numTiles",parseInt(this._settingsModel.get("numTiles"),10)),this.numTilesView=new a({controlTypes:{Number:h},controlType:"Number",label:t("Select the number of services to monitor: ").t(),controlOptions:{modelAttribute:"numTiles",model:this._settingsModel,inputClassName:"service-modal-numTiles-field",min:1,max:this._maxNumTiles}}),this.flashMessagesCollection=new o,this.flashMessagesView=new l({collection:this.flashMessagesCollection})},events:e.extend({},n.prototype.events,{"click a.modal-btn-primary":"_saveAttributes"}),_saveAttributes:function(e){e.preventDefault();var t=this.numTilesView.getAllControls()[0].validateNumber();return t?void this.flashMessagesCollection.reset([{key:"invalid",type:"error",html:t}]):(this._settingsModel.set("numTiles",parseInt(this._settingsModel.get("numTiles"),10)),this._inputSettingsModel.set(this._settingsModel.attributes),this.hide(),void this.remove())},render:function(){return this.$el.html(n.TEMPLATE),this.$(n.HEADER_TITLE_SELECTOR).html(this._title),this.$(n.BODY_SELECTOR).append('<div class="modal-messages-container"></div><div class="modal-body-content"></div>'),e(".modal-messages-container",this.$(n.BODY_SELECTOR)).append(this.flashMessagesView.render().$el),e(".modal-body-content",this.$(n.BODY_SELECTOR)).append(this.numTilesView.render().el),this.$(n.FOOTER_SELECTOR).append(n.BUTTON_CANCEL),this.$(n.FOOTER_SELECTOR).append('<a class="btn btn-primary modal-btn-primary">'+this._primaryButtonText+"</a>"),this}})}.apply(t,s),!(void 0!==n&&(e.exports=n))},2120:function(e,t,i){var s,n;s=[i("require/underscore"),i("require/backbone"),i(2121)],n=function(e,t,i){return t.Collection.extend({model:i,comparator:function(e){return-1*e.get("isSelected")}})}.apply(t,s),!(void 0!==n&&(e.exports=n))},2121:function(e,t,i){var s,n;s=[i("require/underscore"),i("require/backbone")],n=function(e,t){return t.Model.extend({defaults:{serviceName:"",serviceId:"",isSelected:0}})}.apply(t,s),!(void 0!==n&&(e.exports=n))},2122:function(e,t,i){var s,n;s=[i("require/underscore"),i("require/backbone"),i(2123),i(2127),i(2128)],n=function(e,t,i,s,n){var a=e.template(s,null,{variable:"vars"});return t.View.extend({className:"service-list-view",initialize:function(e){this.serviceList=new i({collection:this.collection})},events:{"click a.deselect-all":function(t){t.preventDefault(),e.each(this.collection.models,function(e){e.set("isSelected",0)},this)},"click a.select-all":function(t){t.preventDefault(),e.each(this.collection.models,function(e){e.set("isSelected",1)},this)}},render:function(){return this.$el.html(a({_:e},{variable:"vars"})),this.$(".service-list-container").append(this.serviceList.render().el),this}})}.apply(t,s),!(void 0!==n&&(e.exports=n))},2123:function(e,t,i){var s,n;s=[i("require/underscore"),i("require/backbone"),i(2124),i(2126)],n=function(e,t,i,s){return t.View.extend({className:"service-list-view",renderAllRows:function(){this.collection.each(function(e){var t=new i({model:e});$(".service-list-body",this.$el).append(t.render().el)},this)},render:function(){return this.$el.html(s),this.renderAllRows(),this}})}.apply(t,s),!(void 0!==n&&(e.exports=n))},2124:function(e,t,i){var s,n;s=[i("require/underscore"),i("require/backbone"),i(2121),i("views/shared/controls/SyntheticCheckboxControl"),i(2125)],n=function(e,t,i,s,n){var a=e.template(n);return t.View.extend({tagName:"tr",renderControls:function(){this.serviceSelect=new s({model:this.model,modelAttribute:"isSelected"}),$(".service-select-checkbox",this.$el).append(this.serviceSelect.render().el)},render:function(){return this.$el.html(a({_:e,label:this.model.get("serviceName")||""})),this.renderControls(),this}})}.apply(t,s),!(void 0!==n&&(e.exports=n))},2125:function(e,t){e.exports='<td class="service-select-checkbox">\n</td>\n<td class="service-name">\n\t<%-label%>\n</td>\n'},2126:function(e,t){e.exports='<table class="table">\n\t<tbody class="service-list-body">\n\t</tbody>\n</table>'},2127:function(e,t){e.exports='<div class="service-list-header-container" >\n\t<div class="service-list-description">\n\t\t<%- vars._("Select the services to monitor in the Service Health Overview.").t() %>\n\t</div>\n\t<ul class="actions-container">\n\t\t<li><a class="select-all"><%= vars._("Select All").t() %></a></li>\n\t\t<li><a class="deselect-all"><%= vars._("Deselect All").t() %></a></li>\n\t</ul>\n</div>\n<div class="service-list-container"></div>\n'},2128:function(e,t,i){var s=i(2129);"string"==typeof s&&(s=[[e.id,s,""]]);i(15)(s,{});s.locals&&(e.exports=s.locals)},2129:function(e,t,i){t=e.exports=i(14)(),t.push([e.id,".actions-container{margin-top:15px;margin-bottom:15px;margin-left:0}.actions-container li{display:inline;list-style-type:none;margin-right:10px}",""])},2130:function(e,t,i){var s=i(2131);"string"==typeof s&&(s=[[e.id,s,""]]);i(15)(s,{});s.locals&&(e.exports=s.locals)},2131:function(e,t,i){t=e.exports=i(14)(),t.push([e.id,".btn:focus{outline:none}.modal-body-content .control-label,.modal-body-content .controls{display:inline-block}.modal-body-content input.service-modal-numTiles-field{display:inline-block;width:40px;margin-left:15px}",""])},2132:function(e,t,i){var s,n;s=[i("shim/jquery"),i("require/underscore"),i("require/backbone"),e,i("views/shared/Modal"),i(1686),i("collections/shared/FlashMessages"),i("views/shared/FlashMessagesLegacy"),i(929),i("views/shared/controls/ControlGroup"),i(2133),i(2135)],n=function(e,t,i,s,n,a,r,l,o,h){return n.extend({moduleId:String(s.id),className:n.CLASS_NAME+" "+n.CLASS_MODAL_WIDE+" kpi-filter-modal",events:t.extend({},n.prototype.events,{"click .modal-btn-primary":"_saveAttributes"}),initialize:function(e){if(n.prototype.initialize.apply(this,arguments),this.isFirstRender=!0,this.userSettingsModel=e.userSettingsModel,void 0===this.userSettingsModel||void 0===this.userSettingsModel.attributes.serviceWhitelist||void 0===this.userSettingsModel.attributes.isServiceFilterEnabled||void 0===this.userSettingsModel.attributes.kpiWhitelist||void 0===this.userSettingsModel.attributes.isKpiFilterEnabled)return void console.error("userSettingsModel is invalid. Can't render modal.");this._maxNumTiles=500;var i=e.optionalSettingsModel.attributes||{};this._settingsModel=new a(i),this._settingsModel.set("numTiles",parseInt(this._settingsModel.get("numTiles"),10)),this.flashMessagesCollection=new r,this.children.flashMessagesLegacy=new l({collection:this.flashMessagesCollection}),this.numTilesView=new h({controlTypes:{Number:o},controlType:"Number",label:t("Select the number of KPIs to monitor: ").t(),controlOptions:{modelAttribute:"numTiles",model:this._settingsModel,inputClassName:"kpi-modal-numTiles-field",min:1,max:this._maxNumTiles}})},_saveAttributes:function(e){e.preventDefault();var t=this.numTilesView.getAllControls()[0].validateNumber();return t?void this.flashMessagesCollection.reset([{key:"invalid",type:"error",html:t}]):(this.userSettingsModel.get("kpiTilesSettings").set({numTiles:parseInt(this._settingsModel.get("numTiles"),10)}),this.hide(),void this.remove())},render:function(){var i=t("Filter KPI Tiles").t(),s=t("Save").t();return this.$el.html(n.TEMPLATE),this.$(n.HEADER_TITLE_SELECTOR).html(i),this.$(n.BODY_SELECTOR).append('<div class="modal-messages-container"></div><div class="modal-body-header"></div><div class="modal-body-content"></div>'),e(".modal-messages-container",this.$(n.BODY_SELECTOR)).append(this.children.flashMessagesLegacy.render().$el),e(".modal-body-header",this.$(n.BODY_SELECTOR)).append(this.numTilesView.render().el),this.$(n.FOOTER_SELECTOR).append(n.BUTTON_CANCEL),this.$(n.FOOTER_SELECTOR).append('<a href="#" class="btn btn-primary modal-btn-primary">'+s+"</a>"),this},mainTemplate:'<div class="kpi-main-list"></div>'})}.apply(t,s),!(void 0!==n&&(e.exports=n))},2135:function(e,t,i){var s=i(2136);"string"==typeof s&&(s=[[e.id,s,""]]);i(15)(s,{});s.locals&&(e.exports=s.locals)},2136:function(e,t,i){t=e.exports=i(14)(),t.push([e.id,".modal-description.active{display:inline!important}.modal-body-header .control-label,.modal-body-header .controls{display:inline-block}.modal-body-header input.kpi-modal-numTiles-field{display:inline-block;width:40px;margin-left:15px}.kpi-filter-modal{width:450px;margin-left:-225px}",""])},2137:function(e,t,i){var s,n;s=[i("shim/jquery"),i("require/underscore"),i("require/backbone"),e,i("views/shared/Modal"),i(2138),i(271),i(2139),i(2140)],n=function(e,t,i,s,n,a,r,l){var o=t.template(l,null,{variable:"vars"}),h=n.extend({moduleId:String(s.id),initialize:function(e){n.prototype.initialize.apply(this,arguments),this.messageId=e.messageId||"no-services",this.showDismiss=!1,e&&e.showDismiss&&(this.showDismiss=e.showDismiss),this.settingsModel=e&&e.settingsModel,this.localSettingsModel=new i.Model({dismissModal:!1}),this.teamsCollection=new r},events:e.extend({},n.events,{"click .ftr-dismiss-modal-container":function(e){e.preventDefault();var t=this.localSettingsModel.get("dismissModal");this.localSettingsModel.set({dismissModal:!t}),this.settingsModel&&(this.localSettingsModel.get("dismissModal")?(this.$(".ftr-dismiss-modal-container .ftr-dismiss-modal-checkbox").html('<i class="icon-box-checked"></i>'),this.settingsModel.entry.content.set("ftr_override","0"),this.settingsModel.save()):(this.$(".ftr-dismiss-modal-container .ftr-dismiss-modal-checkbox").html('<i class="icon-box-unchecked"></i>'),this.settingsModel.entry.content.set("ftr_override","1"),this.settingsModel.save()))}}),render:function(){this.$el.html(n.TEMPLATE),this.$el.css({width:"500px"}),this.$(n.HEADER_TITLE_SELECTOR).html(t("Getting Started").t()),this.$(n.BODY_SELECTOR).append(n.FORM_HORIZONTAL),this.$(n.BODY_FORM_SELECTOR).append(o({_:t,msgId:this.messageId,showDismiss:this.showDismiss},{variable:"vars"})),this.teamsCollection.fetch().done(function(e){var i=t.some(e,function(e){return e.permissions.write===!0});i&&this.$("#create-service-link").show()}.bind(this));var e='<a href="#" class="btn cancel modal-btn-cancel pull-left" data-dismiss="modal">'+t("Close").t()+"</a>";return this.$(n.FOOTER_SELECTOR).append(e),this.$(n.BODY_FORM_SELECTOR).find(".ftr-link").focus(),this}});return h}.apply(t,s),!(void 0!==n&&(e.exports=n))},2138:function(e,t,i){var s,n;s=[i("shim/jquery"),i("require/underscore"),i(841),i("shim/splunk.util"),i(232),i(231),i(1701)],n=function(e,t,i,s,n,a,r){var l=i.extend({initialize:function(e){e.model.savedPage=n,e.collection=a,this._writeGlobalTeam=e.permissions.writeGlobalTeam,e.permissions.canSeeBulkImportDropdownOptions&&(e.importCsvLink=s.make_full_url(["app","itsi","service_importer#importcsv"].join("/"),{originType:"service",importType:"importcsv"}),e.importSearchLink=s.make_full_url(["app","itsi","service_importer#search"].join("/"),{originType:"service",importType:"search"})),i.prototype.initialize.call(this,e)},events:{"click a.add-page":function(e){e.preventDefault(),l.launchCreateServiceModal(this._writeGlobalTeam,this.collection,this.options.objectsCache.baseServiceTemplatesCache)}}});return l.launchCreateServiceModal=function(t,i,s){var n=new r({onHiddenRemove:!0,writeGlobalTeam:t,serviceCollection:i,baseServiceTemplatesCache:s});e("body").append(n.render().$el),n.show()},l}.apply(t,s),!(void 0!==n&&(e.exports=n))},2139:function(e,t){e.exports='<% if (vars.msgId === "no-service") { %>\n\t<h3 class="ftr-modal-header-text">\n\t\t<%- vars._("Welcome to Splunk IT Service Intelligence!").t() %>\n\t</h3>\n\t<p>\n\t\t<%- vars._(\n\t\t\t"Splunk IT Service Intelligence is a premium solution running on the massively scalable, industry-leading Splunk " +  \n\t\t\t"platform for machine data. Splunk ITSI offers an innovative, machine data-driven approach to provide a centralized, " + \n\t\t\t"connected view of dynamic IT services. The solution features powerful visualizations, pre-built correlation " +\n\t\t\t"searches, and advanced analytics to highlight anomalies and pinpoint the root causes that impact service levels " + \n\t\t\t"critical to the business.").t()\n\t\t%>\n\t</p>\n\t<p>\n\t\t<%- vars._(\n\t\t\t"The result is comprehensive visibility and service awareness that finally transforms IT monitoring with " + \n\t\t\t"data-driven analytics.").t()\n\t\t%>\n\t<p>\n\t\t<a href="/help?location=%5Bitsi%3A3.1.2%5Dapp.itsi.service_definition" target="_blank">\n\t\t\t<%- vars._("Learn more about Services and KPIs").t() %>\n\t\t</a>\n\t\t<br>\n\t\t<a href="/help?location=%5Bitsi%3A3.1.2%5Dapp.itsi.entity_importer" target="_blank">\n\t\t\t<%- vars._("Learn more about Entities").t() %>\n\t\t</a>\n\t\t<br>\n\t\t<a href="/help?location=%5Bitsi%3A3.1.2%5Dapp.itsi.roles" target="_blank">\n\t\t\t<%- vars._("Learn more about Users and Roles").t() %>\n\t\t</a>\n\t</p>\n\t<hr>\n\t<p>\n\t\t<span>\n\t\t\t<%- vars._("To get started ").t() %>\n\t\t</span>\n\t</p>\n\t<p>\n\t\t<a href="/app/itsi/homeview?tour=homeview-tour:enterprise" class="ftr-product-tour-link">\n\t\t\t<%- vars._("Take the Product Tour").t() %>\n\t\t</a>\n\t</p>\n\t<p>\n\t\t<a href="/app/itsi/services_lister" class="ftr-link hide" id="create-service-link">\n\t\t\t<%- vars._("Define a Service").t() %>\n\t\t</a>\n\t</p>\n\t<% if (vars.showDismiss) { %>\n\t\t<div class="ftr-dismiss-modal-container">\n\t\t\t<a class="ftr-dismiss-modal-checkbox">\n\t\t\t\t<i class="icon-box-unchecked"></i>\n\t\t\t</a>\n\t\t\t<a class="ftr-dismiss-modal-link">\n\t\t\t\t<%- vars._("Do not show this message again").t() %>\n\t\t\t</a>\n\t\t</div>\n\t<% } %>\n<% } %>\n'},2140:function(e,t,i){var s=i(2141);"string"==typeof s&&(s=[[e.id,s,""]]);i(15)(s,{});s.locals&&(e.exports=s.locals)},2141:function(e,t,i){t=e.exports=i(14)(),t.push([e.id,".ftr-modal-header-text,.ftr-product-tour-link{font-size:18px}.app-components-homepage-ftr-ftrmodalview .modal-body{padding-top:10px}",""])},2142:function(e,t,i){var s,n;s=[i("require/underscore"),i("shim/jquery"),i("require/backbone"),i("collections/SplunkDsBase"),i(2143)],n=function(e,t,i,s,n){var a=s.extend({url:"configs/conf-service_analyzer_settings",model:n,initialize:function(){s.prototype.initialize.apply(this,arguments)}});return a}.apply(t,s),!(void 0!==n&&(e.exports=n))},2143:function(e,t,i){var s,n;s=[i("require/underscore"),i("shim/jquery"),i("require/backbone"),i("models/SplunkDBase")],n=function(e,t,i,s){var n=s.extend({url:"configs/conf-service_analyzer_settings",initialize:function(){s.prototype.initialize.apply(this,arguments)}});return n}.apply(t,s),!(void 0!==n&&(e.exports=n))},2144:function(e,t,i){var s,n;s=[i("require/underscore"),i("shim/jquery"),i("require/backbone"),i("shim/splunk.util"),i("models/shared/DateInput"),i(843),i(1042),i(1044),i(473),i(2145),i(2146)],n=function(e,t,i,s,n,a,r,l,o,h){var d=l.extend({initialize:function(e){if(e=e||{},this._appPageHeaderModel=null,this._firstRender=!0,!(e.saDispatcher&&e.saDispatcher instanceof Object))throw"A reference to event dispatcher must be passed to ServiceAnalyzerPageHeaderView!";if(this._saDispatcher=e.saDispatcher,this._urlTokenModel=e.urlTokenModel,!(e.appPageHeaderModel instanceof i.Model))throw"Page Header Model passed to ServiceAnalyzerPageHeaderView must be a valid model!";if(this._appPageHeaderModel=e.appPageHeaderModel,this.setAppPageHeaderModel(this._appPageHeaderModel),!(e.homeViewSettingsModel instanceof i.Model))throw"Home View reference passed to the ServiceAnalyzerPageHeaderView must be a valid model!";return this.setUserSettingsModel(e.homeViewSettingsModel),this._appPageHeaderModel&&(this.listenTo(this._appPageHeaderModel,"change",this._updateTitleDescription),this.listenTo(this._appPageHeaderModel,"enableSave",this._enableSave),this.listenTo(this._appPageHeaderModel,"disableSave",this._disableSave)),this.listenTo(this._saDispatcher,"enableSave",this._enableSave),this.listenTo(this._saDispatcher,"changeViewMode",this._changeViewMode),e.timeRangePickerCustomDialogOptions={showPresets:!0,showPresetsRealTime:!1,showPresetsAllTime:!1,
showCustom:!0,showCustomRealTime:!0,showCustomRelative:!0,showCustomDate:!1,showCustomDateTime:!1,showCustomAdvanced:!1},e.TimeRangeView=h,l.prototype.initialize.apply(this,arguments)},setAppPageHeaderModel:function(e){e instanceof i.Model&&(this._stateModel instanceof i.Model&&this.stopListening(this._stateModel),this._stateModel=e,this.listenTo(this._stateModel,"change:title change:description",function(){this.title=this._stateModel.get("title"),this.description=this._stateModel.get("description"),this._firstRender&&this.render()}))},_performSave:function(i){i.preventDefault();var s=new n;this._homeViewSettingsModel.set("mod_time",s.strftime("%Y-%m-%d %H:%M:%S")),t("body").append('<div id="home-view-save-action-backdrop" class="modal-backdrop fade in">'),"NotFound"===this._homeViewSettingsModel.get("serviceWhitelist")&&this._homeViewSettingsModel.set({kpiFilterString:"",serviceFilterString:""},{silent:!0});var a=this._homeViewSettingsModel.save();if(a)a.done(function(){t("#home-view-save-action-backdrop").remove()}.bind(this)),a.fail(function(i){var s=new o({errorMessage:e("Could not load/save the service analyzer.").t(),htmlResponse:i});s.show(),t("#home-view-save-action-backdrop").remove()}.bind(this));else{t("#home-view-save-action-backdrop").remove();var r=new o({errorMessage:e("Could not load/save the service analyzer. Validation failed.").t()});r.show()}},_performSaveAs:function(i){i.preventDefault();var n=this._urlTokenModel.get("earliest"),r=this._urlTokenModel.get("latest"),l=this._homeViewSettingsModel.clone(),o=e.clone(this._homeViewSettingsModel.get("acl")),h=s.getConfigValue("USERNAME","");o.owner=h,l.unset("_key"),l.set({isDefault:!1,earliest_time:n,latest_time:r,acl:o});var d=new a({model:{savedPage:l},onHiddenRemove:!0});l.once("sync",function(){this._homeViewSettingsModel.trigger("replace",l),this._disableSave()}.bind(this)),t("body").append(d.render().el),d.show()},_changeViewMode:function(){var e=this.$(".application-page-header-fullscreen");"fullscreen"===this._appPageHeaderModel.get("viewMode")?(t("#header").hide(),t("#footer").hide(),e.removeClass("icon-itsi-icon-fullscreen-enter"),e.addClass("icon-itsi-icon-fullscreen-exit")):(t("#header").show(),t("#footer").show(),e.removeClass("icon-itsi-icon-fullscreen-exit"),e.addClass("icon-itsi-icon-fullscreen-enter"))},events:function(){return e.extend({},l.prototype.events,{"click .btn-save-header":function(e){this.isSaveDisabled()||(this._performSave(e),this._disableSave())},"click .btn-saveas-header":function(e){this._performSaveAs(e)},"click .application-page-header-fullscreen":function(){this.changeViewMode.apply(this,arguments),this._homeViewSettingsModel.set({view:this._appPageHeaderModel.get("viewMode")}),t(window).trigger("resize")}})},render:function(){if(this._firstRender){l.prototype.render.apply(this,arguments);var e=this._timeRangeView.$('a[data-earliest="-15m"]');if(e&&e.length){var t=e.parent();t&&t.length&&t.remove()}this._disableSave(),this._firstRender=!1}return this},_updateTitleDescription:function(){this._homeViewSettingsModel.set({title:this._appPageHeaderModel.get("title"),description:this._appPageHeaderModel.get("description")})},_updateURL:function(){this._urlTokenModel instanceof i.Model&&this._urlTokenModel.save({savedHomeViewId:this._homeViewSettingsModel.id,owner:this._homeViewSettingsModel.get("_owner"),earliest:this._homeViewSettingsModel.get("earliest_time"),latest:this._homeViewSettingsModel.get("latest_time")})},_enableSave:function(){this._isSaveDisabled()&&t(".btn-save-header",this.$el).removeClass("disabled")},_isSaveDisabled:function(){return!!t(".btn-save-header",this.$el).hasClass("disabled")},_disableSave:function(){t(".btn-save-header",this.$el).addClass("disabled"),t(window).unbind("beforeunload")},_replaceUserSettingsModel:function(e){this.setUserSettingsModel(e)},_updateAppPageHeaderModel:function(){this._appPageHeaderModel.set({title:this._homeViewSettingsModel.get("title"),description:this._homeViewSettingsModel.get("description"),earliest:this._homeViewSettingsModel.get("earliest_time"),latest:this._homeViewSettingsModel.get("latest_time")})},setUserSettingsModel:function(e){e instanceof i.Model&&(this._homeViewSettingsModel instanceof i.Model&&this.stopListening(this._homeViewSettingsModel),this._homeViewSettingsModel=e,this._firstRender||(this._updateAppPageHeaderModel(),this._updateURL()),this.listenTo(this._homeViewSettingsModel,"replace",this._replaceUserSettingsModel),this._firstRender||this.render())}});return d}.apply(t,s),!(void 0!==n&&(e.exports=n))},2145:function(e,t,i){var s,n;s=[i("shim/jquery"),i("require/underscore"),i("require/backbone"),i("splunkjs/mvc/timerangeview")],n=function(e,t,i,s){var n=s.extend({_onTimeRangeChange:function(e,t,i){(!i||i&&!i._self)&&e&&t&&this.trigger("change",this._getTimeRange(),this)}});return n}.apply(t,s),!(void 0!==n&&(e.exports=n))},2146:function(e,t,i){var s=i(2147);"string"==typeof s&&(s=[[e.id,s,""]]);i(15)(s,{});s.locals&&(e.exports=s.locals)},2147:function(e,t,i){t=e.exports=i(14)(),t.push([e.id,".application-page-header{padding-right:0;padding-left:15px}.application-page-header-right-container .splunk-timerange{display:inline-block;margin-right:5px}",""])},2182:function(e,t,i){"use strict";function s(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var n=i(479),a=s(n),r=i(482),l=s(r),o=i(483),h=s(o),d=i(484),c=s(d),u=i(485),p=s(u),v=i(152),g=s(v),f=i(458),m=s(f),S=i(494),_=s(S),w=i(1729),k=s(w),M=i(271),b=s(M),y=i(2183),T=s(y);i(591);var x=new b.default,C=x.fetch(),I=function(e){function t(e){(0,l.default)(this,t);var i=(0,c.default)(this,(t.__proto__||(0,a.default)(t)).call(this,e));return i.state={canCreateService:!1},i}return(0,p.default)(t,e),(0,h.default)(t,[{key:"componentDidMount",value:function(){var e=this;C.done(function(t){var i=g.default.some(t,function(e){return!g.default.isNil(e)&&!g.default.isNil(e.permissions)&&e.permissions.write===!0});e.setState({canCreateService:i})})}},{key:"render",value:function(){var e=this.state.canCreateService?m.default.createElement(_.default,{appearance:"primary",to:"services_lister",size:"large"},gettext("Create Your First Service")):null;return m.default.createElement("div",{className:T.default.main},m.default.createElement(k.default,{style:{marginBottom:"20px",textAlign:"center"},level:2},gettext("There are no services available.")),e)}}]),t}(m.default.PureComponent);t.default=I,e.exports=t.default},2183:function(e,t,i){var s=i(2184);"string"==typeof s&&(s=[[e.id,s,""]]);i(15)(s,{});s.locals&&(e.exports=s.locals)},2184:function(e,t,i){t=e.exports=i(14)(),t.push([e.id,".main------dev---1JgUC{width:100%;height:100%;padding-top:100px;text-align:center}",""]),t.locals={main:"main------dev---1JgUC"}},2185:function(e,t,i){"use strict";function s(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var n=i(458),a=s(n),r=i(505),l=s(r);i(591);var o=function(){return a.default.createElement("div",{style:{width:"100%",height:"100%",paddingTop:"20px",paddingLeft:"20px"}},a.default.createElement(l.default,{type:"warning"},gettext("The number of services exceeds the number that can be displayed in the tree view. Filter to a specific service or set of services or switch to the tile view.")))};t.default=o,e.exports=t.default},2314:function(e,t,i){"use strict";function s(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var n=i(458),a=s(n),r=i(1736),l=s(r),o=i(2315),h=s(o);i(591);var d=function(){return a.default.createElement("div",{className:h.default.main},a.default.createElement(l.default,{size:"medium"}),gettext("Loading..."))};t.default=d,e.exports=t.default},2315:function(e,t,i){var s=i(2316);"string"==typeof s&&(s=[[e.id,s,""]]);i(15)(s,{});s.locals&&(e.exports=s.locals)},2316:function(e,t,i){t=e.exports=i(14)(),t.push([e.id,".main------dev---1ftAE>*{display:inline-block;margin:0 10px;vertical-align:middle}",""]),t.locals={main:"main------dev---1ftAE"}},2317:function(e,t){e.exports='<div class="dynamic-container">\n    <div class="health-container">\n        <div class="service-health-container">\n        </div>\n        <div class="kpi-health-container">\n        </div>\n    </div>\n    <div class="side-panel-container">\n        <div class="side-panel"></div>\n    </div>\n</div>\n'},2318:function(e,t,i){var s,n;s=[i("shim/jquery"),i("require/underscore"),i("require/backbone"),i("shim/splunk.util")],n=function(e,t,i,s){var n={getServiceAnalyzerConfStanza:t.memoize(function(i){var n=e.ajax({url:s.make_url("/splunkd/__raw/services/configs/conf-itsi_service_analyzer/"+i+"?output_mode=json")}),a=e.Deferred();return n.done(function(e){e=t.defaults(e,{entry:[{content:{disabled:!0,interval:120}}]}),console.log("conf file fetch for auto-refresh successful."),a.resolve({disabled:e.entry[0].content.disabled,interval:parseInt(e.entry[0].content.interval)})}),n.fail(function(){console.log("Problem while fetching conf file settings for Service Analyzer."),a.resolve({disabled:!0,interval:120})}),a})};return n}.apply(t,s),!(void 0!==n&&(e.exports=n))},2319:function(e,t,i){var s=i(2320);"string"==typeof s&&(s=[[e.id,s,""]]);i(15)(s,{});s.locals&&(e.exports=s.locals)},2320:function(e,t,i){t=e.exports=i(14)(),t.push([e.id,"body,html{min-height:100%;min-width:1346px;height:100%}.generic-page-main{display:flex;flex-direction:column;height:100%}.splunk-header{min-height:auto}#app-main-layout{min-height:500px}#app-main-layout,.main-container{display:flex;flex-direction:column;flex:1;padding:0}.main-container{min-height:0}.application-page-header{padding-right:20px}.application-page-sub-header{padding-right:10px}.dynamic-container{background:#fff;display:flex;flex:1;flex-direction:row;overflow:hidden}.title h2{max-width:250px;overflow:hidden;text-overflow:ellipsis;white-space:nowrap}.view-header-container{float:right;width:300px}.tile-selection-dropdown-container{width:100px;position:absolute;margin-left:380px}.homeview-time-range-picker-container{float:right;display:inline-block;margin-left:10px}.homeview-header-menu{float:right;display:inline-block}.kpi-health-tiles{margin-top:20px}.service-health-tiles{margin-top:3px}.severity-tiles-header-container{display:inline-block;height:16px;margin-left:40px}.service-health-container .controls{width:500px}.service-health-container .control-label{display:none}.service-health-container .severity-tiles-selection-controls{margin-top:6px}.severity-tiles-header-container .control-group{margin-bottom:0;display:inline}.service-multi-input-select-container{font-size:12px}.health-container{flex:1;overflow-y:scroll;padding-top:10px}.result-not-found{color:#999;text-align:center}.kpi-health-header,.service-health-header{padding-left:10px;font-size:16px;margin-top:10px;margin-bottom:10px}.kpi-health-data,.service-health-data{overflow:auto;min-width:210px}.top-notable-event-header{padding-bottom:10px}.top-notable-event-container{padding-left:10px}.service-analyzer-tree-container{flex:1;position:relative;width:100%}.service-analyzer-tree-loading{left:0;position:absolute;text-align:center;top:50px;width:100%;z-index:1}.side-panel-container{display:flex;z-index:2}",""])}});