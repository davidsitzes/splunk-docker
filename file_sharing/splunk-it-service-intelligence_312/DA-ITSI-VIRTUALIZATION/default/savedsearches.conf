#--------#
# ENTITY #
#--------#

[DA-ITSI-VIRTUALIZATION-Hypervisor_Search]
description = Search for discovering Hypervisor Entities
search = tag=hostsystem tag=inventory tag=virtualization hypervisor_id=* | stats delim="," latest(hypervisor_name) as hypervisor_name, latest(mem_capacity) as mem_capacity, latest(cpu_cores) as cpu_cores, latest(logical_cpu_count) as logical_cpu_count, latest(processor_socket_count) as processor_socket_count, latest(nic_count) as nic_count, values(nic_type) as nic_type, latest(hyperthreading) as hyperthreading, latest(processor) as processor, latest(hypervisor_os) as hypervisor_os, values(ip) as ip, latest(cluster_id) as cluster_id, latest(cluster_name) as cluster_name, latest(datacenter) as datacenter, latest(hypervisor_os_version) as hypervisor_os_version, latest(vendor) as vendor, latest(vendor_product) as vendor_product, latest(product) as product by hypervisor_id | mvcombine nic_type | eval itsi_role="virtualization", type="hypervisor", description="This is a hypervisor hosting multiple virtual machines", mem_capacity_MB = round(mem_capacity/1048576,2), vendor="\"".vendor."\"", vendor_product="\"".vendor_product."\"", ip="\"".ip."\"", nic_type="\"".nic_type."\""
dispatch.earliest_time = -4d
dispatch.latest_time = now
request.ui_dispatch_app = itsi
request.ui_dispatch_view = search

[DA-ITSI-VIRTUALIZATION-Virtual_Machine_Search]
description = Search for discovering Virtual Machine Entities
search = tag=virtualmachine tag=inventory tag=virtualization vm_id=* | stats delim="," latest(vm_name) as vm_name, latest(storage_capacity) as storage_capacity, latest(mem_capacity) as mem_capacity, latest(cpu_cores) as cpu_cores, latest(logical_cpu_count) as logical_cpu_count, latest(power_state) as power_state, latest(vm_os) as vm_os, latest(vm_os_version) as vm_os_version, values(ip) as ip, values(datastore) as datastore, values(datastore_volume_path) as datastore_volume_path, latest(hypervisor_id) as hypervisor_id, latest(hypervisor_name) as hypervisor_name, latest(cluster_id) as cluster_id, latest(cluster_name) as cluster_name, latest(hypervisor_os_version) as hypervisor_os_version, latest(vendor) as vendor, latest(vendor_product) as vendor_product by vm_id | mvcombine datastore | eval itsi_role="virtualization", type="virtualmachine", description="This is a virtual machine running on a hypervisor", mem_capacity_MB = round(mem_capacity/1048576,2), storage_capacity_GB = round(storage_capacity/1073741824,2), vendor="\"".vendor."\"", vendor_product="\"".vendor_product."\"", ip="\"".ip."\"", datastore="\"".datastore."\"", datastore_volume_path="\"".datastore_volume_path."\""
dispatch.earliest_time = -4d
dispatch.latest_time = now
request.ui_dispatch_app = itsi
request.ui_dispatch_view = search

[DA-ITSI-VIRTUALIZATION-Datastore_Search]
description = Search for discovering Datastore Entities
search = tag=datastore tag=inventory tag=virtualization datastore_id=* | stats delim="," latest(datastore_name) as datastore_name, latest(root_path) as root_path, latest(root_url) as root_url, latest(root_volume_type) as root_volume_type, latest(storage_capacity) as storage_capacity, latest(storage_free_space) as storage_free_space, latest(serial) as serial, values(ip) as ip, latest(datastore_version) as datastore_version, latest(vendor) as vendor, latest(vendor_product) as vendor_product by datastore_id | mvcombine ip | eval itsi_role="virtualization", type="datastore", description="This is a datastore connected to hypervisors", storage_capacity_GB = round(storage_capacity/1073741824,2), storage_free_space_GB = round(storage_free_space/1073741824,2), vendor="\"".vendor."\"", vendor_product="\"".vendor_product."\""
dispatch.earliest_time = -4d
dispatch.latest_time = now
request.ui_dispatch_app = itsi
request.ui_dispatch_view = search

[DA-ITSI-VIRTUALIZATION-Virtualization_Entity_Search]
description = Search for discovering Datastore, Hypervisor and Virtual Machine Entities
search = tag=hostsystem tag=inventory tag=virtualization hypervisor_id=* | dedup hypervisor_id | eval type="hypervisor" | rename hypervisor_id as entity_title | fields entity_title type | append [search tag=datastore tag=inventory tag=virtualization datastore_id=* | dedup datastore_id | eval type="datastore" | rename datastore_id as entity_title | fields entity_title type ] | append [search tag=virtualmachine tag=inventory tag=virtualization vm_id=* | dedup vm_id | eval type="virtualmachine" | rename vm_id as entity_title | fields entity_title type ] | eval itsi_role="virtualization" | table entity_title, type, itsi_role
dispatch.earliest_time = -4d
dispatch.latest_time = now
request.ui_dispatch_app = itsi
request.ui_dispatch_view = search

#-----------#
# INVENTORY #
#-----------#

[DA-ITSI-VIRTUALIZATION-Hypervisor_Inventory_Search]
description = Inventory of Hypervisor
search = tag=hostsystem tag=inventory tag=virtualization hypervisor_id="$hypervisor_id$" | stats latest(hypervisor_name) as "Name", latest(cluster_name) as "Cluster", latest(vendor) as "Vendor", latest(hypervisor_os_version) as "Version", latest(cpu_cores) as "CPU Cores per Socket", latest(logical_cpu_count) as "Logical CPU Count", latest(mem_capacity) as "mem_capacity", latest(nic_count) as "NICs", latest(vendor_product) as "Vendor Product" | eval "Memory(MB)" = round(mem_capacity/1048576,2) | fields - mem_capacity
request.ui_dispatch_app = itsi
request.ui_dispatch_view = search

[DA-ITSI-VIRTUALIZATION-Virtual_Machine_Inventory_Search]
description = Inventory of Virtual Machine
search = tag=virtualmachine tag=inventory tag=virtualization vm_id="$vm_id$" | stats latest(vm_name) as "Name", latest(hypervisor_name) as "Hypervisor Name", latest(cluster_name) as "Cluster Name", latest(vm_os) as "OS", latest(power_state) as "Power State", latest(cpu_cores) as "CPU Cores per Socket", latest(logical_cpu_count) as "Logical CPU Count", latest(mem_capacity) as "mem_capacity", latest(vendor) as "Vendor", latest(hypervisor_os_version) as "Version", latest(vm_os_version) as "OS Version", latest(vendor_product) as "Vendor Product", latest(hypervisor_id) as "Hypervisor Id" | eval "Memory(MB)" = round(mem_capacity/1048576,2) | fields - mem_capacity
request.ui_dispatch_app = itsi
request.ui_dispatch_view = search

[DA-ITSI-VIRTUALIZATION-Datastore_Inventory_Search]
description = Inventory of Datastore
search = tag=datastore tag=inventory tag=virtualization datastore_id="$datastore_id$" | stats latest(datastore_name) as "Datastore Name", latest(root_volume_type) as "Volume Type", latest(root_path) as "Path", latest(root_url) as "URL", latest(storage_capacity) as storage_capacity, latest(storage_free_space) as storage_free_space, latest(vendor) as "Vendor", latest(vendor_product) as "Vendor Product", latest(version) as "Version" | eval "Storage Capacity(GB)"= round(storage_capacity/1073741824,2), "Storage Free(GB)" = round(storage_free_space/1073741824,2) | fields - storage_capacity, storage_free_space
request.ui_dispatch_app = itsi
request.ui_dispatch_view = search

#-------------------------#
# MINICHARTS : HYPERVISOR #
#-------------------------#

[DA-ITSI-VIRTUALIZATION-Hypervisor_Context_Chart_Event_Search]
search = tag=hostsystem tag=virtualization hypervisor_id="$hypervisor_id$" | timechart count | eventstats sum(count) as _total | eval _total = tostring(_total, "commas")." events"
request.ui_dispatch_app = itsi
request.ui_dispatch_view = search

[DA-ITSI-VIRTUALIZATION-Hypervisor_Context_Chart_CPU_Usage_Search]
search = tag=hostsystem tag=cpu tag=performance tag=virtualization hypervisor_id="$hypervisor_id$" cpu_load_percent=*  | timechart avg(cpu_load_percent) as cpu_pct | eventstats avg(cpu_pct) as average | eventstats min(cpu_pct) as minimum | eventstats max(cpu_pct) as maximum | eval _stats = "Range: ".round(minimum, 1)." - ".round(maximum, 1)."%, "."Average: ".round(average, 1)."%" | fields - average, minimum, maximum
request.ui_dispatch_app = itsi
request.ui_dispatch_view = search

[DA-ITSI-VIRTUALIZATION-Hypervisor_Context_Chart_Memory_Usage_Search]
search = tag=hostsystem tag=memory tag=performance tag=virtualization hypervisor_id="$hypervisor_id$" mem_usage_percent=* | timechart avg(mem_usage_percent) as mem_pct | eventstats avg(mem_pct) as average | eventstats min(mem_pct) as minimum | eventstats max(mem_pct) as maximum | eval _stats = "Range: ".round(minimum, 1)." - ".round(maximum, 1)."%, "."Average: ".round(average, 1)."%" | fields - average, minimum, maximum
request.ui_dispatch_app = itsi
request.ui_dispatch_view = search

#----------------------------- #
# MINICHARTS : VIRTUAL MACHINE #
#----------------------------- #

[DA-ITSI-VIRTUALIZATION-Virtual_Machine_Context_Chart_Event_Search]
search = tag=virtualmachine tag=virtualization vm_id="$vm_id$" | timechart count | eventstats sum(count) as _total | eval _total = tostring(_total, "commas")." events"
request.ui_dispatch_app = itsi
request.ui_dispatch_view = search

[DA-ITSI-VIRTUALIZATION-Virtual_Machine_Context_Chart_CPU_Usage_Search]
search = tag=virtualmachine tag=cpu tag=performance tag=virtualization vm_id="$vm_id$" cpu_load_percent=* | timechart avg(cpu_load_percent) as cpu_pct | eventstats avg(cpu_pct) as average | eventstats min(cpu_pct) as minimum | eventstats max(cpu_pct) as maximum | eval _stats = "Range: ".round(minimum, 1)." - ".round(maximum, 1)."%, "."Average: ".round(average, 1)."%" | fields - average, minimum, maximum
request.ui_dispatch_app = itsi
request.ui_dispatch_view = search

[DA-ITSI-VIRTUALIZATION-Virtual_Machine_Context_Chart_Memory_Usage_Search]
search = tag=virtualmachine tag=memory tag=performance tag=virtualization vm_id="$vm_id$" mem_usage_percent=* | timechart avg(mem_usage_percent) as mem_pct | eventstats avg(mem_pct) as average | eventstats min(mem_pct) as minimum | eventstats max(mem_pct) as maximum | eval _stats = "Range: ".round(minimum, 1)." - ".round(maximum, 1)."%, "."Average: ".round(average, 1)."%" | fields - average, minimum, maximum
request.ui_dispatch_app = itsi
request.ui_dispatch_view = search

[DA-ITSI-VIRTUALIZATION-Virtual_Machine_Context_Chart_Storage_Usage_Search]
search = tag=virtualmachine tag=virtualmachine tag=storage tag=performance tag=virtualization vm_id="$vm_id$" storage_used_percent=* | timechart avg(storage_used_percent) as storage_pct | eventstats avg(storage_pct) as average | eventstats min(storage_pct) as minimum | eventstats max(storage_pct) as maximum | eval _stats = "Range: ".round(minimum, 1)." - ".round(maximum, 1)."%, "."Average: ".round(average, 1)."%" | fields - average, minimum, maximum
request.ui_dispatch_app = itsi
request.ui_dispatch_view = search

#------------------------#
# MINICHARTS : DATASTORE #
#------------------------#

[DA-ITSI-VIRTUALIZATION-Datastore_Context_Chart_Event_Search]
search = tag=datastore tag=virtualization datastore_id="$datastore_id$" | timechart count | eventstats sum(count) as _total | eval _total = tostring(_total, "commas")." events"
request.ui_dispatch_app = itsi
request.ui_dispatch_view = search

[DA-ITSI-VIRTUALIZATION-Datastore_Context_Chart_Storage_Usage_Search]
search = tag=datastore tag=storage tag=performance tag=virtualization datastore_id="$datastore_id$" datastore_used_percent=* | timechart avg(datastore_used_percent) as storage_used_pct  | eventstats avg(storage_used_pct) as average | eventstats min(storage_used_pct) as minimum | eventstats max(storage_used_pct) as maximum | eval _stats = "Range: ".round(minimum, 1)." - ".round(maximum, 1)."%, "."Average: ".round(average, 1)."%" | fields - average, minimum, maximum
request.ui_dispatch_app = itsi
request.ui_dispatch_view = search

#------------------------#
# DASHBOARD : HYPERVISOR #
#------------------------#

[DA-ITSI-VIRTUALIZATION-Hypervisor_Chart_CPU_Allocation_Percent_Search]
search = tag=hostsystem tag=cpu tag=performance tag=virtualization hypervisor_id="$hypervisor_id$" cpu_allocation_percent=* | timechart eval(round(avg(cpu_allocation_percent), 2)) as "CPU Allocation (%)"
request.ui_dispatch_app = itsi
request.ui_dispatch_view = search

[DA-ITSI-VIRTUALIZATION-Hypervisor_Chart_CPU_Demand_Search]
search = tag=hostsystem tag=cpu tag=performance tag=virtualization hypervisor_id="$hypervisor_id$" cpu_demand=* | timechart eval(round(avg(cpu_demand), 2)) as "CPU Demand (MHz)"
request.ui_dispatch_app = itsi
request.ui_dispatch_view = search

[DA-ITSI-VIRTUALIZATION-Hypervisor_Chart_CPU_Usage_Percent_Search]
search = tag=hostsystem tag=cpu tag=performance tag=virtualization hypervisor_id="$hypervisor_id$" cpu_load_percent=* | timechart eval(round(avg(cpu_load_percent), 2)) as "CPU Utilization (%)"
request.ui_dispatch_app = itsi
request.ui_dispatch_view = search

[DA-ITSI-VIRTUALIZATION-Hypervisor_Chart_Memory_Pages_Search]
search = tag=hostsystem tag=memory tag=performance tag=virtualization hypervisor_id="$hypervisor_id$" mem_page_rate=* | timechart eval(round(avg(mem_page_rate), 2)) as "Memory Page Rate"
request.ui_dispatch_app = itsi
request.ui_dispatch_view = search

[DA-ITSI-VIRTUALIZATION-Hypervisor_Chart_Memory_Provisioned_Search]
search = tag=hostsystem tag=memory tag=performance tag=virtualization hypervisor_id="$hypervisor_id$" mem_provisioned=* | eval mem_provisioned_MB = mem_provisioned/1048576 | timechart eval(round(avg(mem_provisioned_MB), 2)) as "Memory Provisioned (MB)"
request.ui_dispatch_app = itsi
request.ui_dispatch_view = search

[DA-ITSI-VIRTUALIZATION-Hypervisor_Chart_Memory_Usage_Percent_Search]
search = tag=hostsystem tag=memory tag=performance tag=virtualization hypervisor_id="$hypervisor_id$" mem_usage_percent=* | timechart eval(round(avg(mem_usage_percent), 2)) as "Memory Usage (%)"
request.ui_dispatch_app = itsi
request.ui_dispatch_view = search

[DA-ITSI-VIRTUALIZATION-Hypervisor_NIC_Search]
search = tag=hostsystem tag=network tag=performance tag=virtualization hypervisor_id="$hypervisor_id$" (network_usage_in=* OR network_usage_out=*) | stats avg(network_usage_in) as network_usage_in, avg(network_usage_out) as network_usage_out by nic_id | eval "Received KBps" = round(network_usage_in, 2), "Transmitted KBps" = round(network_usage_out, 2) | rename nic_id as "NIC Id" | fields + "NIC Id","Received KBps","Transmitted KBps" | sort "NIC Id"
request.ui_dispatch_app = itsi
request.ui_dispatch_view = search

[DA-ITSI-VIRTUALIZATION-Hypervisor_Chart_Network_Usage_Search]
search = tag=hostsystem tag=network tag=performance tag=virtualization hypervisor_id="$hypervisor_id$" nic_id="$nic_id$" (network_usage_in=* OR network_usage_out=*) | timechart eval(round(avg(network_usage_in), 2)) as "Received KBps",eval(round(avg(network_usage_out), 2)) as "Transmitted KBps" by nic_id
request.ui_dispatch_app = itsi
request.ui_dispatch_view = search

[DA-ITSI-VIRTUALIZATION-Hypervisor_Chart_Network_Packets_Dropped_Search]
search = tag=hostsystem tag=network tag=performance tag=virtualization hypervisor_id="$hypervisor_id$" (packets_dropped_in=* OR packets_dropped_out=*) | timechart eval(round(sum(packets_dropped_in), 2)) as "Packets Dropped In",eval(round(sum(packets_dropped_out), 2)) as "Packets Dropped Out"
request.ui_dispatch_app = itsi
request.ui_dispatch_view = search

[DA-ITSI-VIRTUALIZATION-Hypervisor_Chart_Storage_Highest_Latency_Search]
search = tag=hostsystem tag=storage tag=performance tag=virtualization hypervisor_id="$hypervisor_id$" (highest_latency=* OR storage_device_latency=* OR os_storage_latency=* OR storage_queue_latency=*) | timechart eval(round(avg(highest_latency), 2)) as "Storage Highest Latency (ms)",eval(round(avg(storage_device_latency), 2)) as "Device Latency",eval(round(avg(os_storage_latency), 2)) as "OS Latency",eval(round(avg(storage_queue_latency), 2)) as "Queue Latency"
request.ui_dispatch_app = itsi
request.ui_dispatch_view = search

[DA-ITSI-VIRTUALIZATION-Hypervisor_Chart_Storage_Read_Write_Latency_Search]
search = tag=hostsystem tag=storage tag=performance tag=virtualization hypervisor_id="$hypervisor_id$" (read_latency=* OR write_latency=*) | timechart eval(round(avg(read_latency), 2)) as "Read Latency (ms)",eval(round(avg(write_latency), 2)) as "Write Latency (ms)" by datastore_id
request.ui_dispatch_app = itsi
request.ui_dispatch_view = search

[DA-ITSI-VIRTUALIZATION-Hypervisor_Chart_Storage_Usage_Search]
search = tag=hostsystem tag=storage tag=performance tag=virtualization hypervisor_id="$hypervisor_id$" storage_usage=* | timechart eval(round(avg(storage_usage), 2)) as "Storage Usage (KBps)"
request.ui_dispatch_app = itsi
request.ui_dispatch_view = search

[DA-ITSI-VIRTUALIZATION-Hypervisor_List_Connected_Datastore_Search]
search = tag=datastore tag=storage tag=performance tag=virtualization datastore_used_percent=* | stats avg(datastore_used_percent) as datastore_used_percent by datastore_id | join type=inner max=0 datastore_id [ | inputlookup hypervisor_datastore_inventory where hypervisor_id="$hypervisor_id$" ] | eval "Datastore Storage Used (%)" = round(datastore_used_percent,2) | rename datastore_id as "Datastore Id", datastore_name as "Datastore Name", accessible as Accessible | fields + "Datastore Id", "Datastore Name", "Datastore Storage Used (%)", "Accessible" | sort - "Datastore Storage Used (%)"
request.ui_dispatch_app = itsi
request.ui_dispatch_view = search

[DA-ITSI-VIRTUALIZATION-Hypervisor_List_Connected_VM_Search]
search = | inputlookup virtual_machine_inventory where hypervisor_id="$hypervisor_id$" |search vm_name="*$vm_name$*" | rename vm_id as "VM Id", vm_name as "VM Name", power_state as "Power State", vm_uptime as "VM Up Time (Sec)" | sort + "VM Name" | sort - "Power State"
request.ui_dispatch_app = itsi
request.ui_dispatch_view = search

[DA-ITSI-VIRTUALIZATION-Hypervisor_List_Connected_VM_CPU_Demand]
search = tag=virtualmachine tag=cpu tag=performance tag=virtualization cpu_demand=* | stats avg(cpu_demand) as "cpu_demand" by vm_id | lookup virtual_machine_inventory vm_id as vm_id OUTPUT vm_id as "VM Id", vm_name as "VM Name", hypervisor_id as hypervisor_id | where hypervisor_id="$hypervisor_id$" | eval "CPU Demand (MHz)" = round(cpu_demand,2) | fields + "VM Id","VM Name","CPU Demand (MHz)" | sort - "CPU Demand (MHz)" | head 10
request.ui_dispatch_app = itsi
request.ui_dispatch_view = search

[DA-ITSI-VIRTUALIZATION-Hypervisor_List_Connected_VM_CPU_Load_Percent]
search = tag=virtualmachine tag=cpu tag=performance tag=virtualization cpu_load_percent=* | stats avg(cpu_load_percent) as "cpu_load_percent" by vm_id | lookup virtual_machine_inventory vm_id as vm_id OUTPUT vm_id as "VM Id", vm_name as "VM Name", hypervisor_id as hypervisor_id | where hypervisor_id="$hypervisor_id$" | eval "CPU Utilization (%)" = round(cpu_load_percent,2) | fields + "VM Id","VM Name","CPU Utilization (%)" | sort - "CPU Utilization (%)" | head 10
request.ui_dispatch_app = itsi
request.ui_dispatch_view = search

[DA-ITSI-VIRTUALIZATION-Hypervisor_List_Connected_VM_Memory_Usage_Percent]
search = tag=virtualmachine tag=memory tag=performance tag=virtualization mem_usage_percent=* | stats avg(mem_usage_percent) as "mem_usage_percent" by vm_id | lookup virtual_machine_inventory vm_id as vm_id OUTPUT vm_id as "VM Id", vm_name as "VM Name", hypervisor_id as hypervisor_id | where hypervisor_id="$hypervisor_id$" | eval "Memory Usage Percent" = round(mem_usage_percent,2) | fields + "VM Id","VM Name","Memory Usage Percent" | sort - "Memory Usage Percent" | head 10
request.ui_dispatch_app = itsi
request.ui_dispatch_view = search

[DA-ITSI-VIRTUALIZATION-Hypervisor_List_Connected_VM_Memory_Provisioned]
search = tag=virtualmachine tag=memory tag=performance tag=virtualization mem_provisioned=* | stats avg(mem_provisioned) as "mem_provisioned" by vm_id | lookup virtual_machine_inventory vm_id as vm_id OUTPUT vm_id as "VM Id", vm_name as "VM Name", hypervisor_id as hypervisor_id | where hypervisor_id="$hypervisor_id$" | eval "Memory Provisioned (MB)" = round(mem_provisioned/1048576,2) | fields + "VM Id","VM Name","Memory Provisioned (MB)" | sort - "Memory Provisioned (MB)" | head 10
request.ui_dispatch_app = itsi
request.ui_dispatch_view = search

[DA-ITSI-VIRTUALIZATION-Hypervisor_List_Connected_VM_Memory_Reserved]
search = tag=virtualmachine tag=memory tag=performance tag=virtualization mem_reserved=* | stats avg(mem_reserved) as "mem_reserved" by vm_id | lookup virtual_machine_inventory vm_id as vm_id OUTPUT vm_id as "VM Id", vm_name as "VM Name", hypervisor_id as hypervisor_id | where hypervisor_id="$hypervisor_id$" | eval "Memory Reserved (MB)" = round(mem_reserved/1048576,2) | fields + "VM Id","VM Name","Memory Reserved (MB)" | sort - "Memory Reserved (MB)" | head 10
request.ui_dispatch_app = itsi
request.ui_dispatch_view = search

[DA-ITSI-VIRTUALIZATION-Hypervisor_List_Connected_VM_Network_Usage]
search = tag=virtualmachine tag=network tag=performance tag=virtualization network_usage=* | stats avg(network_usage) as "network_usage" by vm_id | lookup virtual_machine_inventory vm_id as vm_id OUTPUT vm_id as "VM Id", vm_name as "VM Name", hypervisor_id as hypervisor_id | where hypervisor_id="$hypervisor_id$" | eval "Network Usage (KBps)" = round(network_usage,2) | fields + "VM Id","VM Name","Network Usage (KBps)" | sort - "Network Usage (KBps)" | head 10
request.ui_dispatch_app = itsi
request.ui_dispatch_view = search

[DA-ITSI-VIRTUALIZATION-Hypervisor_List_Connected_VM_Highest_Latency]
search = tag=virtualmachine tag=storage tag=performance tag=virtualization highest_latency=* | stats avg(highest_latency) as "highest_latency" by vm_id | lookup virtual_machine_inventory vm_id as vm_id OUTPUT vm_id as "VM Id", vm_name as "VM Name", hypervisor_id as hypervisor_id | where hypervisor_id="$hypervisor_id$" | eval "Storage Highest Latency (ms)" = round(highest_latency,2) | fields + "VM Id","VM Name","Storage Highest Latency (ms)" | sort - "Storage Highest Latency (ms)" | head 10
request.ui_dispatch_app = itsi
request.ui_dispatch_view = search

[DA-ITSI-VIRTUALIZATION-Hypervisor_List_Connected_VM_Storage_Used_Percent]
search = tag=virtualmachine tag=storage tag=performance tag=virtualization storage_used_percent=* | stats avg(storage_used_percent) as "storage_used_percent" by vm_id | lookup virtual_machine_inventory vm_id as vm_id OUTPUT vm_id as "VM Id", vm_name as "VM Name", hypervisor_id as hypervisor_id | where hypervisor_id="$hypervisor_id$" | eval "Storage Used Percent" = round(storage_used_percent,2) | fields + "VM Id","VM Name","Storage Used Percent" | sort - "Storage Used Percent" | head 10
request.ui_dispatch_app = itsi
request.ui_dispatch_view = search

[DA-ITSI-VIRTUALIZATION-Hypervisor_Events_Search]
search = tag=hostsystem tag=virtualization hypervisor_id="$hypervisor_id$"
request.ui_dispatch_app = itsi
request.ui_dispatch_view = search

#-----------------------------#
# DASHBOARD : VIRTUAL MACHINE #
#-----------------------------#

[DA-ITSI-VIRTUALIZATION-Virtual_Machine_Chart_CPU_Demand_Search]
search = tag=virtualmachine tag=cpu tag=performance tag=virtualization vm_id="$vm_id$" cpu_demand=* | timechart eval(round(avg(cpu_demand), 2)) as "CPU Demand (MHz)"
request.ui_dispatch_app = itsi
request.ui_dispatch_view = search

[DA-ITSI-VIRTUALIZATION-Virtual_Machine_Chart_CPU_Usage_Percent_Search]
search = tag=virtualmachine tag=cpu tag=performance tag=virtualization vm_id="$vm_id$" cpu_load_percent=* | timechart eval(round(avg(cpu_load_percent), 2)) as "CPU Utilization (%)"
request.ui_dispatch_app = itsi
request.ui_dispatch_view = search

[DA-ITSI-VIRTUALIZATION-Virtual_Machine_Chart_Memory_Reserved_Search]
search = tag=virtualmachine tag=memory tag=performance tag=virtualization vm_id="$vm_id$" mem_reserved=* | eval mem_reserved_MB = mem_reserved/1048576 | timechart eval(round(avg(mem_reserved_MB), 2)) as "Memory Reserved (MB)"
request.ui_dispatch_app = itsi
request.ui_dispatch_view = search

[DA-ITSI-VIRTUALIZATION-Virtual_Machine_Chart_Memory_Provisioned_Search]
search = tag=virtualmachine tag=memory tag=performance tag=virtualization vm_id="$vm_id$" mem_provisioned=* | eval mem_provisioned_MB = mem_provisioned/1048576 | timechart eval(round(avg(mem_provisioned_MB), 2)) as "Memory Provisioned (MB)"
request.ui_dispatch_app = itsi
request.ui_dispatch_view = search

[DA-ITSI-VIRTUALIZATION-Virtual_Machine_Chart_Memory_Usage_Percent_Search]
search = tag=virtualmachine tag=memory tag=performance tag=virtualization vm_id="$vm_id$" mem_usage_percent=* | timechart eval(round(avg(mem_usage_percent), 2)) as "Memory Usage (%)"
request.ui_dispatch_app = itsi
request.ui_dispatch_view = search

[DA-ITSI-VIRTUALIZATION-Virtual_Machine_NIC_Search]
search = tag=virtualmachine tag=network tag=performance tag=virtualization vm_id="$vm_id$" (network_usage_in=* OR network_usage_out=*) | stats avg(network_usage_in) as network_usage_in, avg(network_usage_out) as network_usage_out by nic_id | eval "Received KBps" = round(network_usage_in, 2), "Transmitted KBps" = round(network_usage_out, 2) | rename nic_id as "NIC Id" | fields + "NIC Id","Received KBps","Transmitted KBps" | sort "NIC Id"
request.ui_dispatch_app = itsi
request.ui_dispatch_view = search

[DA-ITSI-VIRTUALIZATION-Virtual_Machine_Chart_Network_Usage_Search]
search = tag=virtualmachine tag=network tag=performance tag=virtualization vm_id="$vm_id$" nic_id="$nic_id$" (network_usage_in=* OR network_usage_out=*) | timechart eval(round(avg(network_usage_in), 2)) as "Received KBps",eval(round(avg(network_usage_out), 2)) as "Transmitted KBps" by nic_id
request.ui_dispatch_app = itsi
request.ui_dispatch_view = search

[DA-ITSI-VIRTUALIZATION-Virtual_Machine_Chart_Network_Packets_Dropped_Search]
search = tag=virtualmachine tag=network tag=performance tag=virtualization vm_id="$vm_id$" (packets_dropped_in=* OR packets_dropped_out=*) | timechart eval(round(sum(packets_dropped_in), 2)) as "Packets Dropped In",eval(round(sum(packets_dropped_out), 2)) as "Packets Dropped Out"
request.ui_dispatch_app = itsi
request.ui_dispatch_view = search

[DA-ITSI-VIRTUALIZATION-Virtual_Machine_Chart_Storage_Highest_Latency_Search]
search = tag=virtualmachine tag=storage tag=performance tag=virtualization vm_id="$vm_id$" highest_latency=* | timechart eval(round(avg(highest_latency), 2)) as "Storage Highest Latency (ms)"
request.ui_dispatch_app = itsi
request.ui_dispatch_view = search

[DA-ITSI-VIRTUALIZATION-Virtual_Machine_Chart_Storage_Read_Write_Latency_Search]
search = tag=virtualmachine tag=storage tag=performance tag=virtualization vm_id="$vm_id$" (read_latency=* OR write_latency=*) | timechart eval(round(avg(read_latency), 2)) as "Read Latency (ms)",eval(round(avg(write_latency), 2)) as "Write Latency (ms)" by datastore_id
request.ui_dispatch_app = itsi
request.ui_dispatch_view = search

[DA-ITSI-VIRTUALIZATION-Virtual_Machine_Chart_Storage_Used_Percent_Search]
search = tag=virtualmachine tag=storage tag=performance tag=virtualization vm_id="$vm_id$" storage_used_percent=* | timechart eval(round(avg(storage_used_percent), 2)) as "Storage Used (%)" by datastore_id
request.ui_dispatch_app = itsi
request.ui_dispatch_view = search

[DA-ITSI-VIRTUALIZATION-Virtual_Machine_Chart_Storage_Usage_Search]
search = tag=virtualmachine tag=storage tag=performance tag=virtualization vm_id="$vm_id$" storage_usage=* | timechart eval(round(avg(storage_usage), 2)) as "Storage Usage (KBps)"
request.ui_dispatch_app = itsi
request.ui_dispatch_view = search

[DA-ITSI-VIRTUALIZATION-Virtual_Machine_List_Connected_Datastore_Search]
search = | inputlookup virtual_machine_datastore_inventory where vm_id="$vm_id$" | eval "Committed (MB)" = round(committed/1048576,2), "Uncommitted (MB)" = round(uncommitted/1048576,2) | rename datastore_id as "Datastore Id", datastore_name as "Datastore Name", accessible as Accessible | fields + "Datastore Id", "Datastore Name", "Accessible", "Committed (MB)", "Uncommitted (MB)" | sort - "Committed (MB)"
request.ui_dispatch_app = itsi
request.ui_dispatch_view = search

[DA-ITSI-VIRTUALIZATION-VM_Events_Search]
search = tag=virtualmachine tag=virtualization vm_id="$vm_id$"
request.ui_dispatch_app = itsi
request.ui_dispatch_view = search

#-----------------------#
# DASHBOARD : DATASTORE #
#-----------------------#

[DA-ITSI-VIRTUALIZATION-Datastore_Chart_Storage_Highest_Latency_Search]
search = tag=datastore tag=storage tag=performance tag=virtualization datastore_id="$datastore_id$" datastore_highest_latency=* | timechart avg(datastore_highest_latency) as "Highest Latency (ms)"
request.ui_dispatch_app = itsi
request.ui_dispatch_view = search

[DA-ITSI-VIRTUALIZATION-Datastore_Chart_Storage_Read_Write_Latency_Search]
search = tag=datastore tag=storage tag=performance tag=virtualization datastore_id="$datastore_id$" (datastore_read_latency=* OR datastore_write_latency=*) | timechart eval(round(avg(datastore_read_latency), 2)) as "Read Latency (ms)",eval(round(avg(datastore_write_latency), 2)) as "Write Latency (ms)"
request.ui_dispatch_app = itsi
request.ui_dispatch_view = search

[DA-ITSI-VIRTUALIZATION-Datastore_Chart_Storage_Used_Percent_Search]
search = tag=datastore tag=storage tag=performance tag=virtualization datastore_id="$datastore_id$" datastore_used_percent=*  | timechart avg(datastore_used_percent) as "Storage Used (%)"
request.ui_dispatch_app = itsi
request.ui_dispatch_view = search

[DA-ITSI-VIRTUALIZATION-Datastore_Chart_Storage_Usage_Search]
search = tag=datastore tag=storage tag=performance tag=virtualization datastore_id="$datastore_id$" storage_usage=* | timechart eval(round(avg(storage_usage), 2)) as "Storage Usage (KBps)"
request.ui_dispatch_app = itsi
request.ui_dispatch_view = search

[DA-ITSI-VIRTUALIZATION-Datastore_Details_Search]
search = tag=datastore tag=virtualization datastore_id="$datastore_id$" | stats latest(datastore_name) as "Name", latest(storage_capacity) as storage_capacity, latest(storage_free_space) as storage_free_space, latest(committed) as committed, latest(uncommitted) as uncommitted | eval "Storage Capacity (MB)" = round(storage_capacity/1048576,2), "Storage Free (MB)" = round(storage_free_space/1048576,2), "Committed (MB)" = round(committed/1048576,2), "Uncommitted (MB)" = round(uncommitted/1048576,2) | fields + "Name", "Storage Capacity (MB)", "Storage Free (MB)", "Committed (MB)", "Uncommitted (MB)"
request.ui_dispatch_app = itsi
request.ui_dispatch_view = search

[DA-ITSI-VIRTUALIZATION-Datastore_List_Connected_Hypervisor_Search]
search = | inputlookup hypervisor_datastore_inventory where datastore_id="$datastore_id$" | rename hypervisor_id as "Hypervisor Id", hypervisor_name as "Hypervisor Name", accessible as "Accessible" | fields + "Hypervisor Id", "Hypervisor Name", "Accessible"
request.ui_dispatch_app = itsi
request.ui_dispatch_view = search

[DA-ITSI-VIRTUALIZATION-Datastore_List_Connected_VM_Search]
search = | inputlookup virtual_machine_datastore_inventory where datastore_id="$datastore_id$" | search vm_name="*$vm_name$*" | eval "Committed (MB)" = round(committed/1048576,2), "Uncommitted (MB)" = round(uncommitted/1048576,2) | rename vm_id as "VM Id", vm_name as "VM Name", accessible as "Accessible" | fields + "VM Id", "VM Name", "Committed (MB)", "Uncommitted (MB)", "Accessible"
request.ui_dispatch_app = itsi
request.ui_dispatch_view = search

[DA-ITSI-VIRTUALIZATION-Datastore_Events_Search]
search = tag=datastore tag=virtualization datastore_id="$datastore_id$"
request.ui_dispatch_app = itsi
request.ui_dispatch_view = search

#-----------------------#
#   INVENTORY LOOKUPS   #
#-----------------------#

[DA-ITSI-VIRTUALIZATION-Hypervisor_Inventory_Lookup_Search]
description = Hypervisor inventory information search
search = tag=hostsystem tag=inventory tag=virtualization hypervisor_id=* | stats latest(hypervisor_name) as hypervisor_name by hypervisor_id | outputlookup hypervisor_inventory
dispatch.earliest_time = -4d
dispatch.latest_time = now
request.ui_dispatch_app = itsi
request.ui_dispatch_view = search
cron_schedule = */15 * * * 0-6
enableSched = 1

[DA-ITSI-VIRTUALIZATION-Hypervisor_Datastore_Inventory_Lookup_Search]
description = Hypervisor datastore inventory information search
search = | inputlookup virtual_machine_datastore_inventory| join type=left max=0 vm_id [ | inputlookup virtual_machine_inventory ] | stats list(accessible) as accessible by hypervisor_id, datastore_id | append [ search tag=hostsystem tag=inventory tag=virtualization hypervisor_id=* | stats latest(accessible) as accessible by hypervisor_id, datastore_id ] | stats list(accessible) as accessible by hypervisor_id, datastore_id | eval accessible = lower(mvindex(accessible,-1)) | lookup datastore_inventory datastore_id as datastore_id OUTPUT datastore_name as datastore_name | lookup hypervisor_inventory hypervisor_id as hypervisor_id OUTPUT hypervisor_name as hypervisor_name | outputlookup hypervisor_datastore_inventory
dispatch.earliest_time = -4d
dispatch.latest_time = now
request.ui_dispatch_app = itsi
request.ui_dispatch_view = search
cron_schedule = */15 * * * 0-6
enableSched = 1

[DA-ITSI-VIRTUALIZATION-Virtual_Machine_Inventory_Lookup_Search]
description = Virtual Machine inventory information search
search = tag=virtualmachine tag=inventory tag=virtualization vm_id=* | stats latest(vm_name) as vm_name, latest(hypervisor_id) as hypervisor_id, latest(power_state) as power_state, latest(vm_uptime) as vm_uptime by vm_id | outputlookup virtual_machine_inventory
dispatch.earliest_time = -4d
dispatch.latest_time = now
request.ui_dispatch_app = itsi
request.ui_dispatch_view = search
cron_schedule = */15 * * * 0-6
enableSched = 1

[DA-ITSI-VIRTUALIZATION-Virtual_Machine_Datastore_Inventory_Lookup_Search]
description = Virtual Machine datastore inventory information search
search = tag=virtualmachine tag=inventory tag=virtualization vm_id=* | eval accessible = lower(accessible) | stats latest(vm_name) as vm_name, latest(hypervisor_id) as hypervisor_id, latest(committed) as committed, latest(uncommitted) as uncommitted, latest(accessible) as accessible by vm_id, datastore_id | lookup datastore_inventory datastore_id as datastore_id OUTPUT datastore_name as datastore_name | outputlookup virtual_machine_datastore_inventory
dispatch.earliest_time = -4d
dispatch.latest_time = now
request.ui_dispatch_app = itsi
request.ui_dispatch_view = search
cron_schedule = */15 * * * 0-6
enableSched = 1

[DA-ITSI-VIRTUALIZATION-Datastore_Inventory_Lookup_Search]
description = Datastore inventory information search
search = tag=datastore tag=inventory tag=virtualization datastore_id=* | stats latest(datastore_name) as datastore_name by datastore_id | outputlookup datastore_inventory
dispatch.earliest_time = -4d
dispatch.latest_time = now
request.ui_dispatch_app = itsi
request.ui_dispatch_view = search
cron_schedule = */15 * * * 0-6
enableSched = 1