#--------#
# ENTITY #
#--------#

[DA-ITSI-STORAGE-Storage_Array_Entity_Search]
description = Storage Array entity discovery search
search = tag=storagearray tag=inventory tag=storagesystem array_id=* | stats delim="," latest(array_name) as array_name, latest(vendor) as vendor, latest(vendor_product) as vendor_product, latest(os) as os, latest(logical_cpu_count) as logical_cpu_count, latest(mem_capacity) as mem_capacity, values(ip) as ip, latest(controller_mode) as controller_mode, latest(array_type) as array_type by array_id | mvcombine ip | eval type="storagearray", description="This is a Storage Array", itsi_role="storagesystem"
dispatch.earliest_time = -4h
dispatch.latest_time = now
request.ui_dispatch_app = itsi
request.ui_dispatch_view = search

[DA-ITSI-STORAGE-Storage_Pool_Entity_Search]
description = Storage Pool entity discovery search
search = tag=storagepool tag=inventory tag=storagesystem pool_id=* | eval storage_capacity_gb=round(storage_capacity/(1024*1024*1024),2) | stats latest(pool_name) as pool_name, latest(array_id) as array_id, latest(storage_used) as storage_used, latest(storage_capacity) as storage_capacity, latest(storage_capacity_gb) as storage_capacity_gb by pool_id | eval type="storagepool", description="This is a Storage Pool created in a Storage Array", itsi_role="storagesystem"
dispatch.earliest_time = -4h
dispatch.latest_time = now
request.ui_dispatch_app = itsi
request.ui_dispatch_view = search

[DA-ITSI-STORAGE-Volume_Entity_Search]
description = Volume entity discovery search
search = tag=volume tag=inventory tag=storagesystem volume_id=* | eval storage_capacity_gb=round(storage_capacity/(1024*1024*1024),2) | stats latest(volume_name) as volume_name, latest(array_id) as array_id, latest(pool_id) as pool_id, latest(pool_name) as pool_name, latest(storage_capacity) as storage_capacity, latest(storage_capacity_gb) as storage_capacity_gb by volume_id | eval type="volume", description="This is a Volume created in Storage Array", itsi_role="storagesystem"
dispatch.earliest_time = -4h
dispatch.latest_time = now
request.ui_dispatch_app = itsi
request.ui_dispatch_view = search

[DA-ITSI-STORAGE-LUN_Entity_Search]
description = LUN entity discovery search
search = tag=lun tag=inventory tag=storagesystem lun_id=* | eval storage_capacity_gb=round(storage_capacity/(1024*1024*1024),2) | stats latest(lun_name) as lun_name, latest(lun_path) as lun_path, latest(serial) as serial, latest(accessible) as accessible, latest(array_id) as array_id, latest(pool_id) as pool_id, latest(pool_name) as pool_name, latest(volume_id) as volume_id, latest(volume_name) as volume_name, latest(storage_capacity) as storage_capacity, latest(storage_capacity_gb) as storage_capacity_gb by lun_id | eval type="lun", description="This is a LUN created in Storage Array", itsi_role="storagesystem"
dispatch.earliest_time = -4h
dispatch.latest_time = now
request.ui_dispatch_app = itsi
request.ui_dispatch_view = search

[DA-ITSI-STORAGE-Disk_Entity_Search]
description = Disk entity discovery search
search = tag=disk tag=inventory tag=storagesystem disk_id=* | eval storage_capacity_gb=round(storage_capacity/(1024*1024*1024),2) | stats latest(disk_name) as disk_name, latest(disk_type) as disk_type, latest(vendor) as vendor, latest(vendor_product) as vendor_product, latest(array_id) as array_id, latest(pool_id) as pool_id, latest(pool_name) as pool_name, latest(storage_capacity) as storage_capacity, latest(storage_capacity_gb) as storage_capacity_gb, latest(raid_group) as raid_group by disk_id | eval type="disk", description="This is a Disk of a Storage Array", itsi_role="storagesystem"
dispatch.earliest_time = -4h
dispatch.latest_time = now
request.ui_dispatch_app = itsi
request.ui_dispatch_view = search

[DA-ITSI-STORAGE-Storage_System_Entity_Search]
description = Search for discovering all entities 
search = tag=storagearray tag=inventory tag=storagesystem array_id=* | dedup array_id | eval type="storagearray" | rename array_id as entity_title | fields entity_title type | append [ search tag=storagepool tag=inventory tag=storagesystem pool_id=* | dedup pool_id | eval type="storagepool" | rename pool_id as entity_title | fields entity_title type ] | append [ search tag=volume tag=inventory tag=storagesystem volume_id=* | dedup volume_id | eval type="volume" | rename volume_id as entity_title | fields entity_title type ] | append [ search tag=lun tag=inventory tag=storagesystem lun_id=* | dedup lun_id | eval type="lun" | rename lun_id as entity_title | fields entity_title type ] | append [ search tag=disk tag=inventory tag=storagesystem disk_id=* | dedup disk_id | eval type="disk" | rename disk_id as entity_title | fields entity_title type ] | eval itsi_role = "storagesystem" | table entity_title, type, itsi_role
dispatch.earliest_time = -4h
dispatch.latest_time = now
request.ui_dispatch_app = itsi
request.ui_dispatch_view = search

#-----------#
# INVENTORY #
#-----------#

[DA-ITSI-STORAGE-Storage_Array_Inventory_Search]
description = Inventory for Storage Array 
search = tag=storagearray tag=inventory tag=storagesystem array_id=$array_id$ | stats delim="," latest(array_name) as "Name", latest(vendor) as "Vendor", latest(vendor_product) as "Vendor Product", latest(os) as "OS", latest(logical_cpu_count) as "Logical CPU", latest(mem_capacity) as "Memory Capacity", values(ip) as "IP", latest(controller_mode) as "Controller Mode", latest(array_type) as "Storage Type" by array_id | fillnull value="" IP | mvcombine "IP" | fields - array_id
dispatch.earliest_time = -4h
dispatch.latest_time = now
request.ui_dispatch_app = itsi
request.ui_dispatch_view = search

[DA-ITSI-STORAGE-Storage_Pool_Inventory_Search]
description = Inventory for Storage Pool
search = tag=storagepool tag=inventory tag=storagesystem pool_id=$pool_id$ | eval storage_capacity_gb=round(storage_capacity/(1024*1024*1024),2), storage_used_gb=round(storage_used/(1024*1024*1024),2) | stats latest(pool_name) as "Name", latest(array_id) as "Storage Array Id", latest(storage_used_gb) as "Storage Pool Used (GB)", latest(storage_capacity_gb) as "Storage Pool Capacity (GB)" by pool_id | fields - pool_id
dispatch.earliest_time = -4h
dispatch.latest_time = now
request.ui_dispatch_app = itsi
request.ui_dispatch_view = search

[DA-ITSI-STORAGE-Volume_Inventory_Search]
description = Inventory for Volume 
search = tag=volume tag=inventory tag=storagesystem volume_id=$volume_id$ | eval storage_capacity_gb=round(storage_capacity/(1024*1024*1024),2) | stats latest(volume_name) as "Name", latest(array_id) as "Storage Array Id", latest(pool_id) as "Storage Pool Id", latest(pool_name) as "Storage Pool Name", latest(storage_capacity_gb) as "Volume Capacity (GB)" by volume_id | fields - volume_id
dispatch.earliest_time = -4h
dispatch.latest_time = now
request.ui_dispatch_app = itsi
request.ui_dispatch_view = search

[DA-ITSI-STORAGE-LUN_Inventory_Search]
description = Inventory for LUN
search = tag=lun tag=inventory tag=storagesystem lun_id=$lun_id$ | eval storage_capacity_gb=round(storage_capacity/(1024*1024*1024),2) | stats latest(lun_name) as "Name", latest(lun_path) as "LUN Path", latest(serial) as "Serial", latest(accessible) as "Accessible", latest(array_id) as "Storage Array Id", latest(pool_id) as "Storage Pool Id", latest(pool_name) as "Storage Pool Name", latest(volume_id) as "Volume Id", latest(volume_name) as "Volume Name", latest(storage_capacity_gb) as "LUN Capacity (GB)" by lun_id | fields - lun_id
dispatch.earliest_time = -4h
dispatch.latest_time = now
request.ui_dispatch_app = itsi
request.ui_dispatch_view = search

[DA-ITSI-STORAGE-Disk_Inventory_Search]
description = Inventory for Disk 
search = tag=disk tag=inventory tag=storagesystem disk_id=$disk_id$ | eval storage_capacity_gb=round(storage_capacity/(1024*1024*1024),2) | stats latest(disk_name) as "Name", latest(disk_type) as "Disk Type", latest(vendor) as "Vendor", latest(vendor_product) as "Vendor Product", latest(array_id) as "Storage Array Id", latest(pool_id) as "Storage Pool Id", latest(pool_name) as "Storage Pool Name", latest(storage_capacity_gb) as "Disk Capacity (GB)", latest(raid_group) as "Raid Group" by disk_id | fields - disk_id
dispatch.earliest_time = -4h
dispatch.latest_time = now
request.ui_dispatch_app = itsi
request.ui_dispatch_view = search

#---------------------------#
# MINICHARTS : STORAGEARRAY #
#---------------------------#

[DA-ITSI-STORAGE-Storage_Array_Context_Chart_Event_Search]
search = tag=storagearray tag=storagesystem array_id="$array_id$" | timechart count | eventstats sum(count) as _total | eval _total = tostring(_total, "commas")." events"
request.ui_dispatch_app = itsi
request.ui_dispatch_view = search

[DA-ITSI-STORAGE-Storage_Array_Context_Chart_Highest_Latency_Search]
search = tag=storagearray tag=performance tag=storagesystem array_id="$array_id$" (latency=* AND latency!="") | timechart avg(latency) as high_latency | eventstats avg(high_latency) as average | eventstats min(high_latency) as minimum | eventstats max(high_latency) as maximum | eval _stats = "Range: ".round(minimum, 1)." - ".round(maximum, 1)." ms, "."Average: ".round(average, 1)." ms" | fields - average, minimum, maximum
request.ui_dispatch_app = itsi
request.ui_dispatch_view = search

#---------------------------#
# MINICHARTS : STORAGEPOOL  #
#---------------------------#

[DA-ITSI-STORAGE-Storage_Pool_Context_Chart_Event_Search]
search = tag=storagepool tag=storagesystem pool_id="$pool_id$" | timechart count | eventstats sum(count) as _total | eval _total = tostring(_total, "commas")." events"
request.ui_dispatch_app = itsi
request.ui_dispatch_view = search

[DA-ITSI-STORAGE-Storage_Pool_Context_Chart_Storage_Used_Search]
search = `stretch_inventory_earliest_time` tag=storagepool tag=inventory tag=storagesystem pool_id="$pool_id$" storage_used_percent=* | timechart avg(storage_used_percent) as storage_used_pct | eventstats avg(storage_used_pct) as average | eventstats min(storage_used_pct) as minimum | eventstats max(storage_used_pct) as maximum | eval _stats = "Range: ".round(minimum, 1)." - ".round(maximum, 1)."%, "."Average: ".round(average, 1)."%" | fields - average, minimum, maximum
request.ui_dispatch_app = itsi
request.ui_dispatch_view = search

#---------------------------#
# MINICHARTS : VOLUME       #
#---------------------------#

[DA-ITSI-STORAGE-Volume_Context_Chart_Event_Search]
search = tag=volume tag=storagesystem volume_id="$volume_id$" | timechart count | eventstats sum(count) as _total | eval _total = tostring(_total, "commas")." events"
request.ui_dispatch_app = itsi
request.ui_dispatch_view = search

[DA-ITSI-STORAGE-Volume_Context_Chart_Highest_Latency_Search]
search = tag=volume tag=performance tag=storagesystem volume_id="$volume_id$" (latency=* AND latency!="") | timechart avg(latency) as high_latency | eventstats avg(high_latency) as average | eventstats min(high_latency) as minimum | eventstats max(high_latency) as maximum | eval _stats = "Range: ".round(minimum, 1)." - ".round(maximum, 1)." ms, "."Average: ".round(average, 1)." ms" | fields - average, minimum, maximum
request.ui_dispatch_app = itsi
request.ui_dispatch_view = search

#---------------------------#
# MINICHARTS : LUN          #
#---------------------------#

[DA-ITSI-STORAGE-LUN_Context_Chart_Event_Search]
search = tag=lun tag=storagesystem lun_id="$lun_id$" | timechart count | eventstats sum(count) as _total | eval _total = tostring(_total, "commas")." events"
request.ui_dispatch_app = itsi
request.ui_dispatch_view = search

[DA-ITSI-STORAGE-LUN_Context_Chart_Highest_Latency_Search]
search = tag=lun tag=performance tag=storagesystem lun_id="$lun_id$" (latency=* AND latency!="") | timechart avg(latency) as high_latency | eventstats avg(high_latency) as average | eventstats min(high_latency) as minimum | eventstats max(high_latency) as maximum | eval _stats = "Range: ".round(minimum, 1)." - ".round(maximum, 1)." ms, "."Average: ".round(average, 1)." ms" | fields - average, minimum, maximum
request.ui_dispatch_app = itsi
request.ui_dispatch_view = search

#---------------------------#
# MINICHARTS : DISK         #
#---------------------------#

[DA-ITSI-STORAGE-Disk_Context_Chart_Event_Search]
search = tag=disk tag=storagesystem disk_id="$disk_id$" | timechart count | eventstats sum(count) as _total | eval _total = tostring(_total, "commas")." events"
request.ui_dispatch_app = itsi
request.ui_dispatch_view = search

[DA-ITSI-STORAGE-Disk_Context_Chart_Highest_Latency_Search]
search = tag=disk tag=performance tag=storagesystem disk_id="$disk_id$" (latency=* AND latency!="") | timechart avg(latency) as high_latency | eventstats avg(high_latency) as average | eventstats min(high_latency) as minimum | eventstats max(high_latency) as maximum | eval _stats = "Range: ".round(minimum, 1)." - ".round(maximum, 1)." ms, "."Average: ".round(average, 1)." ms" | fields - average, minimum, maximum
request.ui_dispatch_app = itsi
request.ui_dispatch_view = search

#--------------------------#
# DASHBOARD : STORAGEARRAY #
#--------------------------#

[DA-ITSI-STORAGE-Storage_Array_Chart_Total_Latency_Search]
search = tag=storagearray tag=performance tag=storagesystem array_id="$array_id$" ( (latency=* AND latency!="") OR (read_latency=* AND read_latency!="") OR (write_latency=* AND write_latency!="") ) | timechart max(latency) as "Highest Latency (ms)", eval(round(avg(read_latency), 2)) as "Read Latency (ms)", eval(round(avg(write_latency), 2)) as "Write Latency (ms)"
request.ui_dispatch_app = itsi
request.ui_dispatch_view = search

[DA-ITSI-STORAGE-Storage_Array_Chart_IOPS_Search]
search = tag=storagearray tag=performance tag=storagesystem array_id="$array_id$" (io_ops=* OR read_ops=* OR write_ops=*) | timechart eval(round(avg(io_ops), 2)) as "IO Operations", eval(round(avg(read_ops), 2)) as "Read Operations", eval(round(avg(write_ops), 2)) as "Write Operations"
request.ui_dispatch_app = itsi
request.ui_dispatch_view = search

[DA-ITSI-STORAGE-Storage_Array_Pie_Chart_Storage_Used_Search]
search = tag=storagepool tag=inventory tag=storagesystem array_id="$array_id$" pool_id=* | stats latest(_time) as _time, latest(storage_used) as storage_used, latest(storage_capacity) as storage_capacity by pool_id array_id | stats sum(storage_used) as storage_used, sum(storage_capacity) as storage_capacity by array_id | eval "Storage Used (%)" = (storage_used*100)/storage_capacity, "Storage Free (%)" = 100-'Storage Used (%)' | eval field_values = "Value" | fields + "Storage Used (%)", "Storage Free (%)", "field_values" | transpose column_name=Field header_field=field_values
request.ui_dispatch_app = itsi
request.ui_dispatch_view = search

[DA-ITSI-STORAGE-Storage_Array_Line_Chart_Storage_Used_Search]
search = tag=storagepool tag=inventory tag=storagesystem array_id="$array_id$" pool_id=* | stats latest(storage_used) as storage_used, latest(storage_capacity) as storage_capacity by pool_id array_id, _time | stats sum(storage_used) as storage_used, sum(storage_capacity) as storage_capacity by array_id, _time | eval storage_used_percent = (storage_used*100)/storage_capacity | timechart eval(round(avg(storage_used_percent), 2)) as "Storage Used (%)"
request.ui_dispatch_app = itsi
request.ui_dispatch_view = search

[DA-ITSI-STORAGE-Storage_Array_Chart_Throughput_Search]
search = tag=storagearray tag=performance tag=storagesystem array_id="$array_id$" (storage_read_throughput=* OR storage_write_throughput=*) | eval storage_read_throughput_mbps=storage_read_throughput/1024, storage_write_throughput_mbps=storage_write_throughput/1024 | timechart eval(round(avg(storage_read_throughput_mbps), 2)) as "Read Throughput (MBps)", eval(round(avg(storage_write_throughput_mbps), 2)) as "Write Throughput (MBps)"
request.ui_dispatch_app = itsi
request.ui_dispatch_view = search

[DA-ITSI-STORAGE-Storage_Array_Chart_Network_Throughput_Search]
search = tag=storagearray tag=performance tag=storagesystem array_id="$array_id$" (network_usage_in=* OR network_usage_out=*) | eval network_usage_out_mbps=network_usage_out/1024, network_usage_in_mbps=network_usage_in/1024 | timechart eval(round(avg(network_usage_in_mbps), 2)) as "Network Usage In (MBps)", eval(round(avg(network_usage_out_mbps), 2)) as "Network Usage Out (MBps)"
request.ui_dispatch_app = itsi
request.ui_dispatch_view = search

[DA-ITSI-STORAGE-Storage_Array_Chart_CPU_Utilization_Search]
search = tag=storagearray tag=performance tag=storagesystem array_id="$array_id$" cpu_load_percent=* | timechart eval(round(avg(cpu_load_percent), 2)) as "CPU Utilization (%)"
request.ui_dispatch_app = itsi
request.ui_dispatch_view = search

[DA-ITSI-STORAGE-Storage_Array_Storage_Pool_Count_Search]
search = `stretch_inventory_earliest_time` tag=storagepool tag=inventory tag=storagesystem array_id="$array_id$" pool_id=* | dedup pool_id | stats count by array_id | chart sum(count) as count
request.ui_dispatch_app = itsi
request.ui_dispatch_view = search

[DA-ITSI-STORAGE-Storage_Array_Volume_Count_Search]
search = `stretch_inventory_earliest_time` tag=volume tag=inventory tag=storagesystem array_id="$array_id$" volume_id=* | dedup volume_id | stats count by array_id | chart sum(count) as count
request.ui_dispatch_app = itsi
request.ui_dispatch_view = search

[DA-ITSI-STORAGE-Storage_Array_LUN_Count_Search]
search = `stretch_inventory_earliest_time` tag=lun tag=inventory tag=storagesystem array_id="$array_id$" lun_id=* | dedup lun_id | stats count by array_id | chart sum(count) as count
request.ui_dispatch_app = itsi
request.ui_dispatch_view = search

[DA-ITSI-STORAGE-Storage_Array_Disk_Count_Search]
search = `stretch_inventory_earliest_time` tag=disk tag=inventory tag=storagesystem array_id="$array_id$" disk_id=* | dedup disk_id | stats count by array_id | chart sum(count) as count
request.ui_dispatch_app = itsi
request.ui_dispatch_view = search

[DA-ITSI-STORAGE-Storage_Array_Storage_Pool_Summary_Search]
search = `stretch_inventory_earliest_time` tag=storagepool tag=inventory tag=storagesystem array_id=$array_id$ pool_id=* | eval storage_capacity_gb=round(storage_capacity/(1024*1024*1024),2), storage_free_gb=round(storage_free/(1024*1024*1024),2) | stats latest(pool_id) as "Storage Pool Id", latest(pool_name) as "Name", latest(storage_used_percent) as "Storage Pool used (%)", latest(storage_capacity_gb) as "Storage Pool Capacity (GB)", latest(storage_free_gb) as "Storage Pool Free (GB)" by pool_id | join type=left max=0 pool_id [ search tag=storagepool tag=performance tag=storagesystem pool_id=* io_ops=* | stats max(io_ops) as "IO Operations" by pool_id ] | fields + "Storage Pool Id", "Name", "Storage Pool used (%)", "Storage Pool Capacity (GB)", "Storage Pool Free (GB)", "IO Operations"
request.ui_dispatch_app = itsi
request.ui_dispatch_view = search

[DA-ITSI-STORAGE-Storage_Array_Disk_Summary_Search]
search = `stretch_inventory_earliest_time` tag=disk tag=inventory tag=storagesystem array_id=$array_id$ disk_id=* | eval storage_capacity_gb=round(storage_capacity/(1024*1024*1024),2) | stats latest(disk_id) as "Disk Id", latest(disk_name) as "Name", latest(storage_capacity_gb) as "Disk Capacity (GB)", latest(disk_type) as "Disk Type", latest(raid_group) as "Raid Group" by disk_id | join type=left max=0 disk_id [ search tag=disk tag=performance tag=storagesystem disk_id=* (latency=* AND latency!="") | stats max(latency) as "Disk Highest Latency (ms)" by disk_id]| fields + "Disk Id", "Name", "Disk Capacity (GB)", "Disk Type", "Raid Group", "Disk Highest Latency (ms)"
request.ui_dispatch_app = itsi
request.ui_dispatch_view = search

[DA-ITSI-STORAGE-Storage_Array_Volume_Summary_Search]
search = `stretch_inventory_earliest_time` tag=volume tag=inventory tag=storagesystem array_id=$array_id$ volume_id=* | eval storage_capacity_gb=round(storage_capacity/(1024*1024*1024),2), storage_free_gb=round(storage_free/(1024*1024*1024),2) | stats latest(volume_id) as "Volume Id", latest(volume_name) as "Name", latest(pool_id) as pool_id, latest(storage_capacity_gb) as "Volume Capacity (GB)", latest(storage_free_gb) as "Volume Free (GB)" by volume_id | join type=left max=0 pool_id [ search `stretch_inventory_earliest_time` tag=storagepool tag=inventory tag=storagesystem pool_id=* | stats latest(pool_name) as "Storage Pool" by pool_id] | join type=left max=0 volume_id [ search tag=volume tag=performance tag=storagesystem volume_id=* (latency=* AND latency!="") | stats max(latency) as "Volume Highest Latency (ms)" by volume_id] | fields + "Volume Id", "Name", "Volume Capacity (GB)", "Volume Free (GB)", "Storage Pool", "Volume Highest Latency (ms)"
request.ui_dispatch_app = itsi
request.ui_dispatch_view = search

[DA-ITSI-STORAGE-Storage_Array_LUN_Summary_Search]
search = `stretch_inventory_earliest_time` tag=lun tag=inventory tag=storagesystem array_id=$array_id$ lun_id=* | eval storage_capacity_gb=round(storage_capacity/(1024*1024*1024),2), storage_free_gb=round(storage_free/(1024*1024*1024),2) | stats latest(lun_id) as "LUN Id", latest(lun_name) as "Name", latest(storage_capacity_gb) as "LUN Capacity (GB)", latest(storage_free_gb) as "LUN Free (GB)", latest(volume_id) as volume_id, latest(accessible) as "Accessible" by lun_id | join type=left max=0 volume_id [ search `stretch_inventory_earliest_time` tag=volume tag=inventory tag=storagesystem volume_id=* | stats latest(volume_name) as "Volume" by volume_id ] | join type=left max=0 lun_id [ search tag=lun tag=performance tag=storagesystem lun_id=* (latency=* AND latency!="") | stats max(latency) as "LUN Highest Latency (ms)" by lun_id] | fields + "LUN Id", "Name", "LUN Capacity (GB)", "LUN Free (GB)", "Accessible", "Volume", "LUN Highest Latency (ms)"
request.ui_dispatch_app = itsi
request.ui_dispatch_view = search

[DA-ITSI-STORAGE-Storage_Array_Events_Search]
search = tag=storagearray tag=storagesystem array_id="$array_id$"
request.ui_dispatch_app = itsi
request.ui_dispatch_view = search

[DA-ITSI-STORAGE-Storage_Array_Histogram_Chart_Storage_Used_Search]
search = | makeresults count=100 | streamstats count as row | bucket row span=20 | dedup row | rename row as storage_used_percent | join type=left max=0 storage_used_percent [ search `stretch_inventory_earliest_time` tag=storagepool tag=inventory tag=storagesystem array_id="$array_id$" storage_used_percent=* | bucket storage_used_percent span=20 ] | eval storage_used_percent = if(storage_used_percent=="100-120", "100", storage_used_percent) | chart count over storage_used_percent by pool_id | rename storage_used_percent as "Storage Used (%)" | fields - NULL
request.ui_dispatch_app = itsi
request.ui_dispatch_view = search

[DA-ITSI-STORAGE-Storage_Array_Histogram_Chart_Latency_Search]
search = tag=storagearray tag=performance tag=storagesystem array_id=$array_id$ (latency=* AND latency!="") | eval latency=trim(latency) | bucket latency span=20| rex field=latency "(?<lowerlimit>\d+)-(?<upperlimit>\d+)" | eval latency=if(lowerlimit>=100, "Higher", latency)| sort lowerlimit| timechart useother=f count by latency
request.ui_dispatch_app = itsi
request.ui_dispatch_view = search

[DA-ITSI-STORAGE-Storage_Array_Histogram_Chart_Storage_Throughput_Search]
search = tag=storagearray tag=performance tag=storagesystem array_id=$array_id$ storage_read_throughput=* storage_write_throughput=* | eval storage_throughput_mbps=(storage_read_throughput+storage_write_throughput)/1024 | bucket storage_throughput_mbps span=20 | rex field=storage_throughput_mbps "(?<lowerlimit>\d+)-(?<upperlimit>\d+)" | eval storage_throughput_mbps=if(lowerlimit>=100, "Higher", storage_throughput_mbps)| sort lowerlimit| timechart useother=f count by storage_throughput_mbps
request.ui_dispatch_app = itsi
request.ui_dispatch_view = search
 
[DA-ITSI-STORAGE-Storage_Array_Error_Events_Search]
search = tag=storagearray tag=storagesystem tag=error array_id="$array_id$"
request.ui_dispatch_app = itsi
request.ui_dispatch_view = search

#--------------------------#
# DASHBOARD : STORAGEPOOL  #
#--------------------------#

[DA-ITSI-STORAGE-Storage_Pool_Chart_IOPS_Search]
search = tag=storagepool tag=performance tag=storagesystem pool_id="$pool_id$" io_ops=* | timechart eval(round(avg(io_ops), 2)) as "IO Operations"
request.ui_dispatch_app = itsi
request.ui_dispatch_view = search

[DA-ITSI-STORAGE-Storage_Pool_Pie_Chart_Storage_Used_Search]
search = tag=storagepool tag=storagesystem pool_id="$pool_id$" storage_used_percent=* | eval storage_free_percent = 100-storage_used_percent | stats avg(storage_used_percent) as "Storage Pool Used (%)", avg(storage_free_percent) as "Storage Pool Free (%)" | eval field_values = "Value" | transpose column_name=Field header_field=field_values
request.ui_dispatch_app = itsi
request.ui_dispatch_view = search

[DA-ITSI-STORAGE-Storage_Pool_Line_Chart_Storage_Used_Search]
search = tag=storagepool tag=storagesystem pool_id="$pool_id$" storage_used_percent=* | timechart eval(round(avg(storage_used_percent), 2)) as "Storage Pool Used (%)"
request.ui_dispatch_app = itsi
request.ui_dispatch_view = search

[DA-ITSI-STORAGE-Storage_Pool_Disk_Summary_Search]
search = `stretch_inventory_earliest_time` tag=storagepool tag=inventory tag=storagesystem pool_id=$pool_id$ | stats latest(pool_name) as pool_name, latest(array_id) as array_id by pool_id | join type=inner max=0 pool_name, array_id [ search `stretch_inventory_earliest_time` tag=disk tag=inventory tag=storagesystem disk_id=* | eval storage_capacity_gb=round(storage_capacity/(1024*1024*1024),2) | stats latest(pool_name) as pool_name, latest(array_id) as array_id, latest(disk_name) as "Name", latest(storage_capacity_gb) as "Disk Capacity (GB)", latest(disk_type) as "Disk Type", latest(raid_group) as "Raid Group" by disk_id ] | join type=left max=0 disk_id [ search tag=disk tag=performance tag=storagesystem disk_id=* (latency=* AND latency!="") | stats max(latency) as "Disk Highest Latency (ms)" by disk_id] | rename disk_id as "Disk Id" | fields + "Disk Id", "Name", "Disk Capacity (GB)", "Disk Type", "Raid Group", "Disk Highest Latency (ms)"
request.ui_dispatch_app = itsi
request.ui_dispatch_view = search

[DA-ITSI-STORAGE-Storage_Pool_Volume_Summary_Search]
search = `stretch_inventory_earliest_time` tag=storagepool tag=inventory tag=storagesystem pool_id=$pool_id$ | stats latest(pool_name) as pool_name, latest(array_id) as array_id by pool_id | join type=inner max=0 pool_name, array_id [ search `stretch_inventory_earliest_time` tag=volume tag=inventory tag=storagesystem volume_id=* | eval storage_capacity_gb=round(storage_capacity/(1024*1024*1024),2), storage_free_gb=round(storage_free/(1024*1024*1024),2) | stats latest(pool_name) as pool_name, latest(array_id) as array_id, latest(volume_name) as "Name", latest(storage_capacity_gb) as "Volume Capacity (GB)", latest(storage_free_gb) as "Volume Free (GB)" by volume_id ] | join type=left max=0 volume_id [ search tag=volume tag=performance tag=storagesystem volume_id=* (latency=* AND latency!="") | stats max(latency) as "Volume Highest Latency (ms)" by volume_id] | rename volume_id as "Volume Id" | fields + "Volume Id", "Name", "Volume Capacity (GB)", "Volume Free (GB)", "Volume Highest Latency (ms)"
request.ui_dispatch_app = itsi
request.ui_dispatch_view = search

[DA-ITSI-STORAGE-Storage_Pool_Events_Search]
search = tag=storagepool tag=storagesystem pool_id="$pool_id$"
request.ui_dispatch_app = itsi
request.ui_dispatch_view = search

[DA-ITSI-STORAGE-Storage_Pool_Histogram_Chart_Storage_Used_Search]
search = `stretch_inventory_earliest_time` tag=storagepool tag=inventory tag=storagesystem storage_used_percent=* pool_id=$pool_id$ | bucket storage_used_percent span=20 | eval storage_used_percent = if(storage_used_percent=="100-120", "100", storage_used_percent) | timechart count by storage_used_percent | rename storage_used_percent as "Storage Pool Used (%)"
request.ui_dispatch_app = itsi
request.ui_dispatch_view = search
 
[DA-ITSI-STORAGE-Storage_Pool_Error_Events_Search]
search = tag=storagepool tag=storagesystem tag=error pool_id="$pool_id$"
request.ui_dispatch_app = itsi
request.ui_dispatch_view = search

#--------------------------#
# DASHBOARD : VOLUME       #
#--------------------------#

[DA-ITSI-STORAGE-Volume_Chart_Total_Latency_Search]
search = tag=volume tag=performance tag=storagesystem volume_id="$volume_id$" ( (latency=* AND latency!="") OR (read_latency=* AND read_latency!="") OR (write_latency=* AND write_latency!="") ) | timechart max(latency) as "Highest Latency (ms)", eval(round(avg(read_latency), 2)) as "Read Latency (ms)", eval(round(avg(write_latency), 2)) as "Write Latency (ms)"
request.ui_dispatch_app = itsi
request.ui_dispatch_view = search

[DA-ITSI-STORAGE-Volume_Chart_IOPS_Search]
search = tag=volume tag=performance tag=storagesystem volume_id="$volume_id$" (io_ops=* OR read_ops=* OR write_ops=*) | timechart eval(round(avg(io_ops), 2)) as "IO Operations", eval(round(avg(read_ops), 2)) as "Read Operations", eval(round(avg(write_ops), 2)) as "Write Operations"
request.ui_dispatch_app = itsi
request.ui_dispatch_view = search

[DA-ITSI-STORAGE-Volume_Chart_Throughput_Search]
search = tag=volume tag=performance tag=storagesystem volume_id="$volume_id$" (storage_read_throughput=* OR storage_write_throughput=*) | eval storage_read_throughput_mbps=storage_read_throughput/1024, storage_write_throughput_mbps=storage_write_throughput/1024 | timechart eval(round(avg(storage_read_throughput_mbps), 2)) as "Read Throughput (MBps)", eval(round(avg(storage_write_throughput_mbps), 2)) as "Write Throughput (MBps)"
request.ui_dispatch_app = itsi
request.ui_dispatch_view = search

[DA-ITSI-STORAGE-Volume_LUN_Summary_Search]
search = `stretch_inventory_earliest_time` tag=volume tag=inventory tag=storagesystem volume_id=$volume_id$ | stats latest(volume_name) as volume_name, latest(array_id) as array_id by volume_id | join type=inner max=0 volume_name, array_id [ search `stretch_inventory_earliest_time` tag=lun tag=inventory tag=storagesystem lun_id=* | eval storage_capacity_gb=round(storage_capacity/(1024*1024*1024),2), storage_free_gb=round(storage_free/(1024*1024*1024),2) | stats latest(volume_name) as volume_name, latest(array_id) as array_id, latest(lun_name) as "Name", latest(storage_capacity_gb) as "LUN Capacity (GB)", latest(storage_free_gb) as "LUN Free (GB)", latest(volume_id) as volume_id, latest(accessible) as "Accessible" by lun_id] | join type=left max=0 lun_id [ search tag=lun tag=performance tag=storagesystem lun_id=* (latency=* AND latency!="") | stats max(latency) as "LUN Highest Latency (ms)" by lun_id] | rename  lun_id as "LUN Id" | fields + "LUN Id", "Name", "LUN Capacity (GB)", "LUN Free (GB)", "Accessible", "LUN Highest Latency (ms)"
request.ui_dispatch_app = itsi
request.ui_dispatch_view = search

[DA-ITSI-STORAGE-Volume_Events_Search]
search = tag=volume tag=storagesystem volume_id="$volume_id$"
request.ui_dispatch_app = itsi
request.ui_dispatch_view = search

[DA-ITSI-STORAGE-Volume_Histogram_Chart_Latency_Search]
search = tag=volume tag=performance tag=storagesystem volume_id=$volume_id$ (latency=* AND latency!="") | eval latency=trim(latency) | bucket latency span=20| rex field=latency "(?<lowerlimit>\d+)-(?<upperlimit>\d+)" | eval latency=if(lowerlimit>=100, "Higher", latency)| sort lowerlimit| timechart useother=f count by latency
request.ui_dispatch_app = itsi
request.ui_dispatch_view = search
 
[DA-ITSI-STORAGE-Volume_Error_Events_Search]
search = tag=volume tag=storagesystem tag=error volume_id="$volume_id$"
request.ui_dispatch_app = itsi
request.ui_dispatch_view = search

[DA-ITSI-STORAGE-Volume_Histogram_Chart_Storage_Throughput_Search]
search = tag=volume tag=performance tag=storagesystem volume_id="$volume_id$" storage_read_throughput=* storage_write_throughput=* | eval storage_throughput_mbps=(storage_read_throughput+storage_write_throughput)/1024 | bucket storage_throughput_mbps span=20 | rex field=storage_throughput_mbps "(?<lowerlimit>\d+)-(?<upperlimit>\d+)" | eval storage_throughput_mbps=if(lowerlimit>=100, "Higher", storage_throughput_mbps)| sort lowerlimit| timechart useother=f count by storage_throughput_mbps
request.ui_dispatch_app = itsi
request.ui_dispatch_view = search

#--------------------------#
# DASHBOARD : LUN          #
#--------------------------#

[DA-ITSI-STORAGE-LUN_Chart_Total_Latency_Search]
search = tag=lun tag=performance tag=storagesystem lun_id="$lun_id$" ( (latency=* AND latency!="") OR (read_latency=* AND read_latency!="") OR (write_latency=* AND write_latency!="") ) | timechart max(latency) as "Highest Latency (ms)", eval(round(avg(read_latency), 2)) as "Read Latency (ms)", eval(round(avg(write_latency), 2)) as "Write Latency (ms)"
request.ui_dispatch_app = itsi
request.ui_dispatch_view = search

[DA-ITSI-STORAGE-LUN_Chart_IOPS_Search]
search = tag=lun tag=performance tag=storagesystem lun_id="$lun_id$" (io_ops=* OR read_ops=* OR write_ops=*) | timechart eval(round(avg(io_ops), 2)) as "IO Operations", eval(round(avg(read_ops), 2)) as "Read Operations", eval(round(avg(write_ops), 2)) as "Write Operations"
request.ui_dispatch_app = itsi
request.ui_dispatch_view = search

[DA-ITSI-STORAGE-LUN_Chart_Throughput_Search]
search = tag=lun tag=performance tag=storagesystem lun_id="$lun_id$" (storage_read_throughput=* OR storage_write_throughput=*) | eval storage_read_throughput_mbps=storage_read_throughput/1024, storage_write_throughput_mbps=storage_write_throughput/1024 | timechart eval(round(avg(storage_read_throughput_mbps), 2)) as "Read Throughput (MBps)", eval(round(avg(storage_write_throughput_mbps), 2)) as "Write Throughput (MBps)"
request.ui_dispatch_app = itsi
request.ui_dispatch_view = search

[DA-ITSI-STORAGE-LUN_Events_Search]
search = tag=lun tag=storagesystem lun_id="$lun_id$"
request.ui_dispatch_app = itsi
request.ui_dispatch_view = search

[DA-ITSI-STORAGE-LUN_Histogram_Chart_Latency_Search]
search = tag=lun tag=performance tag=storagesystem lun_id=$lun_id$ (latency=* AND latency!="") | eval latency=trim(latency) | bucket latency span=20| rex field=latency "(?<lowerlimit>\d+)-(?<upperlimit>\d+)" | eval latency=if(lowerlimit>=100, "Higher", latency)| sort lowerlimit| timechart useother=f count by latency
request.ui_dispatch_app = itsi
request.ui_dispatch_view = search
 
[DA-ITSI-STORAGE-LUN_Error_Events_Search]
search = tag=lun tag=storagesystem tag=error lun_id="$lun_id$"
request.ui_dispatch_app = itsi
request.ui_dispatch_view = search

[DA-ITSI-STORAGE-LUN_Histogram_Chart_Storage_Throughput_Search]
search = tag=lun tag=performance tag=storagesystem lun_id=$lun_id$ storage_read_throughput=* storage_write_throughput=* | eval storage_throughput_mbps=(storage_read_throughput+storage_write_throughput)/1024 | bucket storage_throughput_mbps span=20 | rex field=storage_throughput_mbps "(?<lowerlimit>\d+)-(?<upperlimit>\d+)" | eval storage_throughput_mbps=if(lowerlimit>=100, "Higher", storage_throughput_mbps)| sort lowerlimit| timechart useother=f count by storage_throughput_mbps
request.ui_dispatch_app = itsi
request.ui_dispatch_view = search

#--------------------------#
# DASHBOARD : DISK         #
#--------------------------#

[DA-ITSI-STORAGE-Disk_Chart_Total_Latency_Search]
search = tag=disk tag=performance tag=storagesystem disk_id="$disk_id$" ( (latency=* AND latency!="") OR (read_latency=* AND read_latency!="") OR (write_latency=* AND write_latency!="") ) | timechart max(latency) as "Highest Latency (ms)", eval(round(avg(read_latency), 2)) as "Read Latency (ms)", eval(round(avg(write_latency), 2)) as "Write Latency (ms)"
request.ui_dispatch_app = itsi
request.ui_dispatch_view = search

[DA-ITSI-STORAGE-Disk_Chart_IOPS_Search]
search = tag=disk tag=performance tag=storagesystem disk_id="$disk_id$" (io_ops=* OR read_ops=* OR write_ops=*) | timechart eval(round(avg(io_ops), 2)) as "IO Operations", eval(round(avg(read_ops), 2)) as "Read Operations", eval(round(avg(write_ops), 2)) as "Write Operations"
request.ui_dispatch_app = itsi
request.ui_dispatch_view = search

[DA-ITSI-STORAGE-Disk_Chart_Throughput_Search]
search = tag=disk tag=performance tag=storagesystem disk_id="$disk_id$" (storage_read_throughput=* OR storage_write_throughput=*) | eval storage_read_throughput_mbps=storage_read_throughput/1024, storage_write_throughput_mbps=storage_write_throughput/1024 | timechart eval(round(avg(storage_read_throughput_mbps), 2)) as "Read Throughput (MBps)", eval(round(avg(storage_write_throughput_mbps), 2)) as "Write Throughput (MBps)"
request.ui_dispatch_app = itsi
request.ui_dispatch_view = search

[DA-ITSI-STORAGE-Disk_Events_Search]
search = tag=disk tag=storagesystem disk_id="$disk_id$"
request.ui_dispatch_app = itsi
request.ui_dispatch_view = search

[DA-ITSI-STORAGE-Disk_Histogram_Chart_Latency_Search]
search = tag=disk tag=performance tag=storagesystem disk_id=$disk_id$ (latency=* AND latency!="") | eval latency=trim(latency) | bucket latency span=20| rex field=latency "(?<lowerlimit>\d+)-(?<upperlimit>\d+)" | eval latency=if(lowerlimit>=100, "Higher", latency)| sort lowerlimit| timechart useother=f count by latency
request.ui_dispatch_app = itsi
request.ui_dispatch_view = search
 
[DA-ITSI-STORAGE-Disk_Error_Events_Search]
search = tag=disk tag=storagesystem tag=error disk_id="$disk_id$"
request.ui_dispatch_app = itsi
request.ui_dispatch_view = search

[DA-ITSI-STORAGE-Disk_Chart_Block_Throughput_Search]
search = tag=disk tag=performance tag=storagesystem disk_id="$disk_id$" (read_blocks=* OR write_blocks=*) | timechart eval(round(avg(read_blocks), 2)) as "Read Blocks Throughput", eval(round(avg(write_blocks), 2)) as "Write Blocks Throughput"
request.ui_dispatch_app = itsi
request.ui_dispatch_view = search

[DA-ITSI-STORAGE-Disk_Histogram_Chart_Storage_Throughput_Search]
search = tag=disk tag=performance tag=storagesystem disk_id=$disk_id$ storage_read_throughput=* storage_write_throughput=* | eval storage_throughput_mbps=(storage_read_throughput+storage_write_throughput)/1024 | bucket storage_throughput_mbps span=20 | rex field=storage_throughput_mbps "(?<lowerlimit>\d+)-(?<upperlimit>\d+)" | eval storage_throughput_mbps=if(lowerlimit>=100, "Higher", storage_throughput_mbps)| sort lowerlimit| timechart useother=f count by storage_throughput_mbps
request.ui_dispatch_app = itsi
request.ui_dispatch_view = search

#----------------#
#   BASESEARCH   #
#----------------#

[DA-ITSI-STORAGE-Storage_Array_Base_Search]
search = tag=storagearray tag=performance tag=storagesystem array_id=* | eval storage_read_throughput_mbps=storage_read_throughput/1024, storage_write_throughput_mbps=storage_write_throughput/1024, network_usage_in_mbps=network_usage_in/1024, network_usage_out_mbps=network_usage_out/1024
request.ui_dispatch_app = itsi
request.ui_dispatch_view = search

[DA-ITSI-STORAGE-Storage_Pool_Base_Search]
search = tag=storagepool tag=performance tag=storagesystem pool_id=*
request.ui_dispatch_app = itsi
request.ui_dispatch_view = search

[DA-ITSI-STORAGE-Volume_Base_Search]
search = tag=volume tag=performance tag=storagesystem volume_id=* | eval storage_read_throughput_mbps=storage_read_throughput/1024, storage_write_throughput_mbps=storage_write_throughput/1024
request.ui_dispatch_app = itsi
request.ui_dispatch_view = search

[DA-ITSI-STORAGE-LUN_Base_Search]
search = tag=lun tag=performance tag=storagesystem lun_id=* | eval storage_read_throughput_mbps=storage_read_throughput/1024, storage_write_throughput_mbps=storage_write_throughput/1024
request.ui_dispatch_app = itsi
request.ui_dispatch_view = search

[DA-ITSI-STORAGE-Disk_Base_Search]
search = tag=disk tag=performance tag=storagesystem disk_id=* | eval storage_read_throughput_mbps=storage_read_throughput/1024, storage_write_throughput_mbps=storage_write_throughput/1024
request.ui_dispatch_app = itsi
request.ui_dispatch_view = search